{
  "metadata": {
    "name": "Suspicious Manipulation Of Default Accounts Via Net.EXE",
    "comment": "Detects suspicious manipulations of default accounts such as 'administrator' and 'guest'. For example 'enable' or 'disable' accounts or change the password...etc",
    "annotations": {
      "source": "sigma",
      "category": "process_creation",
      "product": "windows",
      "sigma_status": "test"
    }
  },
  "spec": {
    "schedule": {
      "atLeastEvery": "15m",
      "enabled": true
    },
    "input": {
      "batch": {
        "sql": "SELECT * FROM process_activity WHERE time BETWEEN CURRENT_TIMESTAMP() - INTERVAL 24 HOUR AND CURRENT_TIMESTAMP() AND (lower(activity_id) = lower('1') AND (endswith(lower(process.name), lower('\\\\net.exe')) OR endswith(lower(process.name), lower('\\\\net1.exe'))) AND (lower(LOWER(process.file.name)) in ('net\\.exe', 'net1\\.exe')) AND contains(lower(process.cmd_line), lower(' user ')) AND (contains(lower(process.cmd_line), lower(' j\u00e4rjestelm\u00e4nvalvoja ')) OR contains(lower(process.cmd_line), lower(' rendszergazda ')) OR contains(lower(process.cmd_line), lower(' \u0430\u0434\u043c\u0438\u043d\u0438\u0441\u0442\u0440\u0430\u0442\u043e\u0440 ')) OR contains(lower(process.cmd_line), lower(' administrateur ')) OR contains(lower(process.cmd_line), lower(' administrador ')) OR contains(lower(process.cmd_line), lower(' administrat\u00f6r ')) OR contains(lower(process.cmd_line), lower(' administrator ')) OR contains(lower(process.cmd_line), lower(' guest ')) OR contains(lower(process.cmd_line), lower(' defaultaccount ')) OR contains(lower(process.cmd_line), lower(' \"j\u00e4rjestelm\u00e4nvalvoja\" ')) OR contains(lower(process.cmd_line), lower(' \"rendszergazda\" ')) OR contains(lower(process.cmd_line), lower(' \"\u0430\u0434\u043c\u0438\u043d\u0438\u0441\u0442\u0440\u0430\u0442\u043e\u0440\" ')) OR contains(lower(process.cmd_line), lower(' \"administrateur\" ')) OR contains(lower(process.cmd_line), lower(' \"administrador\" ')) OR contains(lower(process.cmd_line), lower(' \"administrat\u00f6r\" ')) OR contains(lower(process.cmd_line), lower(' \"administrator\" ')) OR contains(lower(process.cmd_line), lower(' \"guest\" ')) OR contains(lower(process.cmd_line), lower(' \"defaultaccount\" ')) OR contains(lower(process.cmd_line), lower(' \\'j\u00e4rjestelm\u00e4nvalvoja\\' ')) OR contains(lower(process.cmd_line), lower(' \\'rendszergazda\\' ')) OR contains(lower(process.cmd_line), lower(' \\'\u0430\u0434\u043c\u0438\u043d\u0438\u0441\u0442\u0440\u0430\u0442\u043e\u0440\\' ')) OR contains(lower(process.cmd_line), lower(' \\'administrateur\\' ')) OR contains(lower(process.cmd_line), lower(' \\'administrador\\' ')) OR contains(lower(process.cmd_line), lower(' \\'administrat\u00f6r\\' ')) OR contains(lower(process.cmd_line), lower(' \\'administrator\\' ')) OR contains(lower(process.cmd_line), lower(' \\'guest\\' ')) OR contains(lower(process.cmd_line), lower(' \\'defaultaccount\\' '))) AND NOT (contains(lower(process.cmd_line), lower('guest')) AND contains(lower(process.cmd_line), lower('/active no'))))"
      }
    },
    "output": {
      "summary": "Detects suspicious manipulations of default accounts such as 'administrator' and 'guest'. For example 'enable' or 'disable' accounts or change the password...etc",
      "defaultContext": true
    },
    "metadata": {
      "version": 1.0,
      "severity": "High",
      "fidelity": "Investigative",
      "objective": "False positive: Some false positives could occur with the admin or guest account. It depends on the scripts being used by the admins in your env. If you experience a lot of FP you could reduce the level to medium References: https://www.trellix.com/en-sg/about/newsroom/stories/threat-labs/lockergoga-ransomware-family-used-in-targeted-attacks.html, https://redacted.com/blog/bianlian-ransomware-gang-gives-it-a-go/, https://www.microsoft.com/security/blog/2022/09/07/profiling-dev-0270-phosphorus-ransomware-operations/",
      "mitre": [
        {
          "taxonomy": "MITRE ATT&CK",
          "tactic": "Collection",
          "techniqueId": "T1560",
          "subTechniqueId": "001"
        }
      ]
    },
    "computeMode": "high"
  },
  "apiVersion": "v1",
  "kind": "Rule"
}