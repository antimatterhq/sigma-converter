{
  "metadata": {
    "name": "Potential Provlaunch.EXE Binary Proxy Execution Abuse",
    "comment": "Detects child processes of \"provlaunch.exe\" which might indicate potential abuse to proxy execution.",
    "annotations": {
      "source": "sigma",
      "category": "process_creation",
      "product": "windows",
      "sigma_status": "test"
    }
  },
  "spec": {
    "schedule": {
      "atLeastEvery": "15m",
      "enabled": true
    },
    "input": {
      "batch": {
        "sql": "SELECT * FROM process_activity WHERE time BETWEEN CURRENT_TIMESTAMP() - INTERVAL 24 HOUR AND CURRENT_TIMESTAMP() AND (lower(activity_id) = lower('1') AND endswith(lower(process.parent_process.name), lower('\\\\provlaunch.exe')) AND NOT ((endswith(lower(process.name), lower('\\\\calc.exe')) OR endswith(lower(process.name), lower('\\\\cmd.exe')) OR endswith(lower(process.name), lower('\\\\cscript.exe')) OR endswith(lower(process.name), lower('\\\\mshta.exe')) OR endswith(lower(process.name), lower('\\\\notepad.exe')) OR endswith(lower(process.name), lower('\\\\powershell.exe')) OR endswith(lower(process.name), lower('\\\\pwsh.exe')) OR endswith(lower(process.name), lower('\\\\regsvr32.exe')) OR endswith(lower(process.name), lower('\\\\rundll32.exe')) OR endswith(lower(process.name), lower('\\\\wscript.exe'))) AND (contains(lower(process.name), lower(':\\\\perflogs\\\\')) OR contains(lower(process.name), lower(':\\\\temp\\\\')) OR contains(lower(process.name), lower(':\\\\users\\\\public\\\\')) OR contains(lower(process.name), lower('\\\\appdata\\\\temp\\\\')) OR contains(lower(process.name), lower('\\\\windows\\\\system32\\\\tasks\\\\')) OR contains(lower(process.name), lower('\\\\windows\\\\tasks\\\\')) OR contains(lower(process.name), lower('\\\\windows\\\\temp\\\\')))))"
      }
    },
    "output": {
      "summary": "Detects child processes of \"provlaunch.exe\" which might indicate potential abuse to proxy execution.",
      "defaultContext": true
    },
    "metadata": {
      "version": 1.0,
      "severity": "Medium",
      "fidelity": "Investigative",
      "objective": "False positive: Unknown References: https://lolbas-project.github.io/lolbas/Binaries/Provlaunch/, https://twitter.com/0gtweet/status/1674399582162153472",
      "mitre": [
        {
          "taxonomy": "MITRE ATT&CK",
          "tactic": "Defense-Evasion",
          "techniqueId": "T1218"
        }
      ]
    },
    "computeMode": "high"
  },
  "apiVersion": "v1",
  "kind": "Rule"
}