{
  "metadata": {
    "name": "Kubernetes Unauthorized or Unauthenticated Access",
    "comment": "Detects when a request to the Kubernetes API is rejected due to lack of authorization or due to an expired authentication token being used. This may indicate an attacker attempting to leverage credentials they have obtained.",
    "annotations": {
      "source": "sigma",
      "product": "kubernetes",
      "service": "audit",
      "sigma_status": "experimental"
    }
  },
  "spec": {
    "schedule": {
      "atLeastEvery": "12h",
      "enabled": false
    },
    "input": {
      "batch": {
        "sql": "SELECT * FROM user_access WHERE time BETWEEN CURRENT_TIMESTAMP() - INTERVAL 24 HOUR AND CURRENT_TIMESTAMP() AND (CAST(api.response.code AS INT) in (401, 403))"
      }
    },
    "output": {
      "summary": "Detects when a request to the Kubernetes API is rejected due to lack of authorization or due to an expired authentication token being used. This may indicate an attacker attempting to leverage credentials they have obtained.",
      "defaultContext": true
    },
    "metadata": {
      "version": 1.0,
      "severity": "Informational",
      "fidelity": "Investigative",
      "objective": "False positive: A misconfigured RBAC policy, a mistake by a valid user, or a wider issue with authentication tokens can also generate these errors. References: https://kubernetes.io/docs/reference/config-api/apiserver-audit.v1/, https://www.datadoghq.com/blog/monitor-kubernetes-audit-logs/#monitor-api-authentication-issues",
      "mitre": [
        {
          "taxonomy": "MITRE ATT&CK",
          "tactic": "Privilege-Escalation"
        }
      ]
    },
    "computeMode": "high"
  },
  "apiVersion": "v1",
  "kind": "Rule"
}