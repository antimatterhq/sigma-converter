{
  "metadata": {
    "name": "System Information Discovery Using System_Profiler",
    "comment": "Detects the execution of \"system_profiler\" with specific \"Data Types\" that have been seen being used by threat actors and malware. It provides system hardware and software configuration information. This process is primarily used for system information discovery. However, \"system_profiler\" can also be used to determine if virtualization software is being run for defense evasion purposes.",
    "annotations": {
      "source": "sigma",
      "category": "process_creation",
      "product": "macos",
      "sigma_status": "test"
    }
  },
  "spec": {
    "schedule": {
      "atLeastEvery": "12h",
      "enabled": false
    },
    "input": {
      "batch": {
        "sql": "SELECT * FROM process_activity WHERE time BETWEEN CURRENT_TIMESTAMP() - INTERVAL 24 HOUR AND CURRENT_TIMESTAMP() AND (activity_id = 1 AND endswith(lower(process.name), lower('/system_profiler')) AND contains(lower(process.cmd_line), lower('system_profiler')) AND (contains(lower(process.cmd_line), lower('spapplicationsdatatype')) OR contains(lower(process.cmd_line), lower('sphardwaredatatype')) OR contains(lower(process.cmd_line), lower('spnetworkdatatype')) OR contains(lower(process.cmd_line), lower('spusbdatatype'))))"
      }
    },
    "output": {
      "summary": "Detects the execution of \"system_profiler\" with specific \"Data Types\" that have been seen being used by threat actors and malware. It provides system hardware and software configuration information. This process is primarily used for system information discovery. However, \"system_profiler\" can also be used to determine if virtualization software is being run for defense evasion purposes.",
      "defaultContext": true
    },
    "metadata": {
      "version": 1.0,
      "severity": "Medium",
      "fidelity": "Investigative",
      "objective": "False positive: Legitimate administrative activities References: https://www.trendmicro.com/en_za/research/20/k/new-macos-backdoor-connected-to-oceanlotus-surfaces.html, https://www.sentinelone.com/wp-content/uploads/pdf-gen/1630910064/20-common-tools-techniques-used-by-macos-threat-actors-malware.pdf, https://ss64.com/mac/system_profiler.html, https://objective-see.org/blog/blog_0x62.html, https://www.welivesecurity.com/2019/04/09/oceanlotus-macos-malware-update/, https://gist.github.com/nasbench/9a1ba4bc7094ea1b47bc42bf172961af",
      "mitre": [
        {
          "taxonomy": "MITRE ATT&CK",
          "tactic": "Discovery",
          "techniqueId": "T1082"
        },
        {
          "taxonomy": "MITRE ATT&CK",
          "tactic": "Discovery",
          "techniqueId": "T1497",
          "subTechniqueId": "001"
        }
      ]
    },
    "computeMode": "high"
  },
  "apiVersion": "v1",
  "kind": "Rule"
}