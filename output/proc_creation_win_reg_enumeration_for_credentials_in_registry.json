{
  "metadata": {
    "name": "Enumeration for Credentials in Registry",
    "comment": "Adversaries may search the Registry on compromised systems for insecurely stored credentials. The Windows Registry stores configuration information that can be used by the system or other programs. Adversaries may query the Registry looking for credentials and passwords that have been stored for use by other programs or services",
    "annotations": {
      "source": "sigma",
      "category": "process_creation",
      "product": "windows",
      "sigma_status": "test"
    }
  },
  "spec": {
    "schedule": {
      "atLeastEvery": "12h",
      "enabled": false
    },
    "input": {
      "batch": {
        "sql": "SELECT * FROM process_activity WHERE time BETWEEN CURRENT_TIMESTAMP() - INTERVAL 24 HOUR AND CURRENT_TIMESTAMP() AND (activity_id = 1 AND endswith(lower(process.name), lower('\\\\\\\\reg.exe')) AND contains(lower(process.cmd_line), lower(' query ')) AND contains(lower(process.cmd_line), lower('/t ')) AND contains(lower(process.cmd_line), lower('reg_sz')) AND contains(lower(process.cmd_line), lower('/s')) AND contains(lower(process.cmd_line), lower('/f ')) AND contains(lower(process.cmd_line), lower('hklm')) AND contains(lower(process.cmd_line), lower('/f ')) AND contains(lower(process.cmd_line), lower('hkcu')) AND contains(lower(process.cmd_line), lower('hkcu\\\\\\\\software\\\\\\\\simontatham\\\\\\\\putty\\\\\\\\sessions')))"
      }
    },
    "output": {
      "summary": "Adversaries may search the Registry on compromised systems for insecurely stored credentials. The Windows Registry stores configuration information that can be used by the system or other programs. Adversaries may query the Registry looking for credentials and passwords that have been stored for use by other programs or services",
      "defaultContext": true
    },
    "metadata": {
      "version": 1.0,
      "severity": "Medium",
      "fidelity": "Investigative",
      "objective": "False positive: Unknown Reference: https://github.com/redcanaryco/atomic-red-team/blob/f339e7da7d05f6057fdfcdd3742bfcf365fee2a9/atomics/T1552.002/T1552.002.md",
      "mitre": [
        {
          "taxonomy": "MITRE ATT&CK",
          "tactic": "Credential-Access",
          "techniqueId": "T1552",
          "subTechniqueId": "002"
        }
      ]
    },
    "computeMode": "high"
  },
  "apiVersion": "v1",
  "kind": "Rule"
}