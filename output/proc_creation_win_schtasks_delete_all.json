{
  "metadata": {
    "name": "Delete All Scheduled Tasks",
    "comment": "Detects the usage of schtasks with the delete flag and the asterisk symbol to delete all tasks from the schedule of the local computer, including tasks scheduled by other users.",
    "annotations": {
      "source": "sigma",
      "category": "process_creation",
      "product": "windows",
      "sigma_status": "test"
    }
  },
  "spec": {
    "schedule": {
      "atLeastEvery": "12h",
      "enabled": false
    },
    "input": {
      "batch": {
        "sql": "SELECT * FROM process_activity WHERE time BETWEEN CURRENT_TIMESTAMP() - INTERVAL 24 HOUR AND CURRENT_TIMESTAMP() AND (activity_id = 1 AND endswith(lower(process.name), lower('\\\\\\\\schtasks.exe')) AND contains(lower(process.cmd_line), lower(' /delete ')) AND contains(lower(process.cmd_line), lower('/tn *')) AND contains(lower(process.cmd_line), lower(' /f')))"
      }
    },
    "output": {
      "summary": "Detects the usage of schtasks with the delete flag and the asterisk symbol to delete all tasks from the schedule of the local computer, including tasks scheduled by other users.",
      "defaultContext": true
    },
    "metadata": {
      "version": 1.0,
      "severity": "High",
      "fidelity": "Investigative",
      "objective": "False positive: Unlikely Reference: https://learn.microsoft.com/en-us/windows-server/administration/windows-commands/schtasks-delete",
      "mitre": [
        {
          "taxonomy": "MITRE ATT&CK",
          "tactic": "Impact",
          "techniqueId": "T1489"
        }
      ]
    },
    "computeMode": "high"
  },
  "apiVersion": "v1",
  "kind": "Rule"
}