{
  "metadata": {
    "name": "File With Uncommon Extension Created By An Office Application",
    "comment": "Detects the creation of files with an executable or script extension by an Office application.",
    "annotations": {
      "source": "sigma",
      "category": "file_event",
      "product": "windows",
      "sigma_status": "test"
    }
  },
  "spec": {
    "schedule": {
      "atLeastEvery": "12h",
      "enabled": false
    },
    "input": {
      "batch": {
        "sql": "SELECT * FROM file_activity WHERE time BETWEEN CURRENT_TIMESTAMP() - INTERVAL 24 HOUR AND CURRENT_TIMESTAMP() AND (lower(activity_id) = lower('1') AND (endswith(lower(actor.process.name), lower('\\\\excel.exe')) OR endswith(lower(actor.process.name), lower('\\\\msaccess.exe')) OR endswith(lower(actor.process.name), lower('\\\\mspub.exe')) OR endswith(lower(actor.process.name), lower('\\\\powerpnt.exe')) OR endswith(lower(actor.process.name), lower('\\\\visio.exe')) OR endswith(lower(actor.process.name), lower('\\\\winword.exe'))) AND (endswith(lower(file.path), lower('.bat')) OR endswith(lower(file.path), lower('.cmd')) OR endswith(lower(file.path), lower('.com')) OR endswith(lower(file.path), lower('.dll')) OR endswith(lower(file.path), lower('.exe')) OR endswith(lower(file.path), lower('.hta')) OR endswith(lower(file.path), lower('.ocx')) OR endswith(lower(file.path), lower('.proj')) OR endswith(lower(file.path), lower('.ps1')) OR endswith(lower(file.path), lower('.scf')) OR endswith(lower(file.path), lower('.scr')) OR endswith(lower(file.path), lower('.sys')) OR endswith(lower(file.path), lower('.vbe')) OR endswith(lower(file.path), lower('.vbs')) OR endswith(lower(file.path), lower('.wsf')) OR endswith(lower(file.path), lower('.wsh'))) AND NOT (contains(lower(file.path), lower('\\\\appdata\\\\local\\\\assembly\\\\tmp\\\\')) AND endswith(lower(file.path), lower('.dll'))) AND NOT (contains(lower(file.path), lower('c:\\\\users\\\\')) AND contains(lower(file.path), lower('\\\\appdata\\\\local\\\\microsoft\\\\office\\\\')) AND contains(lower(file.path), lower('\\\\webservicecache\\\\allusers')) AND endswith(lower(file.path), lower('.com')) OR endswith(lower(actor.process.name), lower('\\\\winword.exe')) AND contains(lower(file.path), lower('\\\\appdata\\\\local\\\\temp\\\\webexdelta\\\\')) AND (endswith(lower(file.path), lower('.dll')) OR endswith(lower(file.path), lower('.exe')))))"
      }
    },
    "output": {
      "summary": "Detects the creation of files with an executable or script extension by an Office application.",
      "defaultContext": true
    },
    "metadata": {
      "version": 1.0,
      "severity": "High",
      "fidelity": "Investigative",
      "objective": "False positive: Unknown References: https://thedfirreport.com/2021/03/29/sodinokibi-aka-revil-ransomware/, https://github.com/vadim-hunter/Detection-Ideas-Rules/blob/02bcbfc2bfb8b4da601bb30de0344ae453aa1afe/Threat%20Intelligence/The%20DFIR%20Report/20210329_Sodinokibi_(aka_REvil)_Ransomware.yaml",
      "mitre": [
        {
          "taxonomy": "MITRE ATT&CK",
          "tactic": "Execution",
          "techniqueId": "T1204",
          "subTechniqueId": "002"
        }
      ]
    },
    "computeMode": "high"
  },
  "apiVersion": "v1",
  "kind": "Rule"
}