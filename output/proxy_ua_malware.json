{
  "metadata": {
    "name": "Malware User Agent",
    "comment": "Detects suspicious user agent strings used by malware in proxy logs",
    "annotations": {
      "source": "sigma",
      "category": "proxy",
      "sigma_status": "test"
    }
  },
  "spec": {
    "schedule": {
      "atLeastEvery": "15m",
      "enabled": true
    },
    "input": {
      "batch": {
        "sql": "SELECT * FROM http_activity WHERE time BETWEEN CURRENT_TIMESTAMP() - INTERVAL 24 HOUR AND CURRENT_TIMESTAMP() AND (lower(http_request.user_agent) = lower('mozilla/5.0 (windows nt 6.1; wow64; rv:53.0) gecko/20100101 chrome /53.0') OR lower(http_request.user_agent) = lower('mozilla/4.0 (compatible; msie 8.0; windows nt 5.1)') OR lower(http_request.user_agent) = lower('mozilla/4.0 (compatible; msie 7.0; windows nt 5.1; trident/4.0)') OR lower(http_request.user_agent) = lower('mozilla/4.0 (compatible; msie 6.0; windows nt 5.0; .net clr  1.1.4322)') OR lower(http_request.user_agent) = lower('httpbrowser/1.0') OR contains(lower(http_request.user_agent), lower('<|>')) OR lower(http_request.user_agent) = lower('nsis_inetc (mozilla)') OR lower(http_request.user_agent) = lower('wget/1.9+cvs-stable (red hat modified)') OR lower(http_request.user_agent) = lower('mozilla/4.0 (compatible; msie 8.0; windows nt 6.1; trident/4.0; .net clr 1.1.4322)') OR contains(lower(http_request.user_agent), lower('zeroup')) OR startswith(lower(http_request.user_agent), lower('mozilla/5.0 (windows nt 5.1 ; v.')) OR contains(lower(http_request.user_agent), lower(' adlib/')) OR endswith(lower(http_request.user_agent), lower(' tiny')) OR contains(lower(http_request.user_agent), lower(' bgroom ')) OR endswith(lower(http_request.user_agent), lower(' changhuatong')) OR endswith(lower(http_request.user_agent), lower(' choltbagent')) OR lower(http_request.user_agent) = lower('mozilla/5.0 wininet') OR lower(http_request.user_agent) = lower('rookie/1.0') OR lower(http_request.user_agent) = lower('m') OR lower(http_request.user_agent) = lower('mozilla/4.0 (compatible; msie 8.0; windows nt 5.1; trident/4.0)') OR lower(http_request.user_agent) = lower('mozilla/4.0 (compatible;msie 7.0;windows nt 6.0)') OR lower(http_request.user_agent) = lower('backdoorbot') OR lower(http_request.user_agent) = lower('mozilla/5.0 (windows; u; windows nt 5.1; en-us; rv:1.9.2.3) gecko/20100401 firefox/3.6.1 (.net clr 3.5.30731)') OR lower(http_request.user_agent) = lower('opera/8.81 (windows nt 6.0; u; en)') OR lower(http_request.user_agent) = lower('mozilla/5.0 (windows; u; windows nt 5.1; en-us; rv:1.9.2.3) gecko/20100401 firefox/3.6.1 (.net clr 3.5.30729)') OR lower(http_request.user_agent) = lower('opera') OR lower(http_request.user_agent) = lower('mozilla/4.0 (compatible; msie 5.0; windows 98)') OR lower(http_request.user_agent) = lower('mozilla/4.0 (compatible; msie 5.01; windows nt 5.0)') OR lower(http_request.user_agent) = lower('msie') OR endswith(lower(http_request.user_agent), lower('(charon; inferno)')) OR lower(http_request.user_agent) = lower('mozilla/4.0 (compatible; msie 8.0; windows nt 5.1; trident/5.0)') OR lower(http_request.user_agent) = lower('mozilla/4.0 (compatible; msie 6.1; windows nt)') OR lower(http_request.user_agent) = lower('mozilla/4.0(compatible; msie 6.0; windows nt 5.1)') OR lower(http_request.user_agent) = lower('mozilla/5.0 (windows nt 10.0; win64; x64)') OR lower(http_request.user_agent) = lower('mozilla/4.0 (compatible; msie 8.0; windows nt 10.0; win64; x64)') OR lower(http_request.user_agent) = lower('mozilla/4.0 (compatible; msie 8.0; windows nt 6.1; win64; x64)') OR lower(http_request.user_agent) = lower('mozilla/4.0 (compatible; msie 7.0; windows nt 6.2; wow64; trident/7.0; .net4.0c; .net4.0e; infopath.3)') OR lower(http_request.user_agent) = lower('mozilla/5.0 (windows nt 6.1)') OR lower(http_request.user_agent) = lower('applewebkit/587.38 (khtml, like gecko)') OR lower(http_request.user_agent) = lower('chrome/91.0.4472.77') OR lower(http_request.user_agent) = lower('safari/537.36') OR lower(http_request.user_agent) = lower('edge/91.0.864.37') OR lower(http_request.user_agent) = lower('firefox/89.0') OR lower(http_request.user_agent) = lower('gecko/20100101') OR contains(lower(http_request.user_agent), lower(' pxyscand')) OR endswith(lower(http_request.user_agent), lower(' asd')) OR endswith(lower(http_request.user_agent), lower(' mdms')) OR lower(http_request.user_agent) = lower('sample') OR lower(http_request.user_agent) = lower('nocase') OR lower(http_request.user_agent) = lower('moxilla') OR startswith(lower(http_request.user_agent), lower('win32 ')) OR contains(lower(http_request.user_agent), lower('microsoft internet explorer')) OR startswith(lower(http_request.user_agent), lower('agent ')) OR lower(http_request.user_agent) = lower('autoit') OR lower(http_request.user_agent) = lower('iczeliondownload') OR lower(http_request.user_agent) = lower('mozilla/4.0 (compatible; msie 9.0; windows nt 10.0; .net4.0c; .net4.0e; tablet pc 2.0)') OR lower(http_request.user_agent) = lower('record') OR lower(http_request.user_agent) = lower('mozzzzzzzzzzz') OR lower(http_request.user_agent) = lower('mozilla/5.0 (windows nt 10.0; win64; x64; rv:76.0) gecko/20100101 firefox/76.0') OR lower(http_request.user_agent) = lower('havana/0.1') OR lower(http_request.user_agent) = lower('antsword/v2.1') OR lower(http_request.user_agent) = lower('rqwrwqrqwrqw') OR lower(http_request.user_agent) = lower('qwrqrwrqwrqwr') OR lower(http_request.user_agent) = lower('rc2.0/client') OR lower(http_request.user_agent) = lower('takemypainback') OR lower(http_request.user_agent) = lower('xxx') OR lower(http_request.user_agent) = lower('20112211') OR lower(http_request.user_agent) = lower('23591') OR lower(http_request.user_agent) = lower('901785252112') OR lower(http_request.user_agent) = lower('1235125521512') OR lower(http_request.user_agent) = lower('125122112551') OR lower(http_request.user_agent) = lower('b1d3n_rim_my_ass') OR lower(http_request.user_agent) = lower('ayayayay1337') OR lower(http_request.user_agent) = lower('imightjustpaymyselfforafeature') OR lower(http_request.user_agent) = lower('forafeature') OR startswith(lower(http_request.user_agent), lower('ares_ldr_v_')) OR lower(http_request.user_agent) = lower('microsoft internet explorer') OR lower(http_request.user_agent) = lower('clctr') OR lower(http_request.user_agent) = lower('uploader') OR lower(http_request.user_agent) = lower('agent') OR lower(http_request.user_agent) = lower('license') OR lower(http_request.user_agent) = lower('vb wininet') OR lower(http_request.user_agent) = lower('client') OR lower(http_request.user_agent) = lower('lilith-bot/3.0') OR lower(http_request.user_agent) = lower('svc/1.0') OR lower(http_request.user_agent) = lower('wshrat') OR lower(http_request.user_agent) = lower('zerostresser botnet/1.5') OR lower(http_request.user_agent) = lower('ok') OR lower(http_request.user_agent) = lower('project1sqlite') OR lower(http_request.user_agent) = lower('project1') OR lower(http_request.user_agent) = lower('ducktales') OR lower(http_request.user_agent) = lower('zadanie') OR lower(http_request.user_agent) = lower('gunnawunnabluetips') OR lower(http_request.user_agent) = lower('xlmst') OR lower(http_request.user_agent) = lower('geekingtothemoon') OR lower(http_request.user_agent) = lower('sunshinemoonlight') OR lower(http_request.user_agent) = lower('bunnyrequester') OR lower(http_request.user_agent) = lower('bunnytasks') OR lower(http_request.user_agent) = lower('bunnystealer') OR lower(http_request.user_agent) = lower('bunnyloader_dropper') OR lower(http_request.user_agent) = lower('bunnyloader') OR lower(http_request.user_agent) = lower('bunnyshell') OR lower(http_request.user_agent) = lower('spark-commit') OR lower(http_request.user_agent) = lower('4b4db4b3') OR lower(http_request.user_agent) = lower('southside') OR lower(http_request.user_agent) = lower('mozilla/4.0 (compatible; msie 7.0; windows nt 5.1; tob 1.1)'))"
      }
    },
    "output": {
      "summary": "Detects suspicious user agent strings used by malware in proxy logs",
      "defaultContext": true
    },
    "metadata": {
      "version": 1.0,
      "severity": "High",
      "fidelity": "Investigative",
      "objective": "False positive: Unknown References: http://rules.emergingthreats.net/open/snort-2.9.0/rules/emerging-user_agents.rules, http://www.botopedia.org/search?searchword=scan&searchphrase=all, https://networkraptor.blogspot.com/2015/01/user-agent-strings.html, https://perishablepress.com/blacklist/ua-2013.txt, https://www.bluecoat.com/en-gb/security-blog/2015-05-05/know-your-agents, https://twitter.com/kladblokje_88/status/1614673320124743681?s=12&t=joEpeVa5d58aHYNGA_To7Q, https://pbs.twimg.com/media/FtYbfsDXoAQ1Y8M?format=jpg&name=large, https://twitter.com/crep1x/status/1635034100213112833",
      "mitre": [
        {
          "taxonomy": "MITRE ATT&CK",
          "tactic": "Command-And-Control",
          "techniqueId": "T1071",
          "subTechniqueId": "001"
        }
      ]
    },
    "computeMode": "high"
  },
  "apiVersion": "v1",
  "kind": "Rule"
}