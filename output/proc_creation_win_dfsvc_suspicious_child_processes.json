{
  "metadata": {
    "name": "Potentially Suspicious Child Process Of ClickOnce Application",
    "comment": "Detects potentially suspicious child processes of a ClickOnce deployment application",
    "annotations": {
      "source": "sigma",
      "category": "process_creation",
      "product": "windows",
      "sigma_status": "test"
    }
  },
  "spec": {
    "schedule": {
      "atLeastEvery": "12h",
      "enabled": false
    },
    "input": {
      "batch": {
        "sql": "SELECT * FROM process_activity WHERE time BETWEEN CURRENT_TIMESTAMP() - INTERVAL 24 HOUR AND CURRENT_TIMESTAMP() AND (activity_id = 1 AND contains(lower(process.parent_process.name), lower('\\\\\\\\appdata\\\\\\\\local\\\\\\\\apps\\\\\\\\2.0\\\\\\\\')) AND (endswith(lower(process.name), lower('\\\\\\\\calc.exe')) OR endswith(lower(process.name), lower('\\\\\\\\cmd.exe')) OR endswith(lower(process.name), lower('\\\\\\\\cscript.exe')) OR endswith(lower(process.name), lower('\\\\\\\\explorer.exe')) OR endswith(lower(process.name), lower('\\\\\\\\mshta.exe')) OR endswith(lower(process.name), lower('\\\\\\\\net.exe')) OR endswith(lower(process.name), lower('\\\\\\\\net1.exe')) OR endswith(lower(process.name), lower('\\\\\\\\nltest.exe')) OR endswith(lower(process.name), lower('\\\\\\\\notepad.exe')) OR endswith(lower(process.name), lower('\\\\\\\\powershell.exe')) OR endswith(lower(process.name), lower('\\\\\\\\pwsh.exe')) OR endswith(lower(process.name), lower('\\\\\\\\reg.exe')) OR endswith(lower(process.name), lower('\\\\\\\\regsvr32.exe')) OR endswith(lower(process.name), lower('\\\\\\\\rundll32.exe')) OR endswith(lower(process.name), lower('\\\\\\\\schtasks.exe')) OR endswith(lower(process.name), lower('\\\\\\\\werfault.exe')) OR endswith(lower(process.name), lower('\\\\\\\\wscript.exe'))))"
      }
    },
    "output": {
      "summary": "Detects potentially suspicious child processes of a ClickOnce deployment application",
      "defaultContext": true
    },
    "metadata": {
      "version": 1.0,
      "severity": "Medium",
      "fidelity": "Investigative",
      "objective": "False positive: Unknown Reference: https://posts.specterops.io/less-smartscreen-more-caffeine-ab-using-clickonce-for-trusted-code-execution-1446ea8051c5",
      "mitre": [
        {
          "taxonomy": "MITRE ATT&CK",
          "tactic": "Execution"
        },
        {
          "taxonomy": "MITRE ATT&CK",
          "tactic": "Defense-Evasion"
        }
      ]
    },
    "computeMode": "high"
  },
  "apiVersion": "v1",
  "kind": "Rule"
}