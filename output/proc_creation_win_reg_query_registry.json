{
  "metadata": {
    "name": "Potential Configuration And Service Reconnaissance Via Reg.EXE",
    "comment": "Detects the usage of \"reg.exe\" in order to query reconnaissance information from the registry. Adversaries may interact with the Windows registry to gather information about credentials, the system, configuration, and installed software.",
    "annotations": {
      "source": "sigma",
      "category": "process_creation",
      "product": "windows",
      "sigma_status": "test"
    }
  },
  "spec": {
    "schedule": {
      "atLeastEvery": "12h",
      "enabled": false
    },
    "input": {
      "batch": {
        "sql": "SELECT * FROM process_activity WHERE time BETWEEN CURRENT_TIMESTAMP() - INTERVAL 24 HOUR AND CURRENT_TIMESTAMP() AND (lower(activity_id) = lower('1') AND endswith(lower(process.name), lower('\\\\reg.exe')) AND lower(process.file.name) = lower('reg.exe') AND contains(lower(process.cmd_line), lower('query')) AND (contains(lower(process.cmd_line), lower('currentversion\\\\windows')) OR contains(lower(process.cmd_line), lower('winlogon\\\\')) OR contains(lower(process.cmd_line), lower('currentversion\\\\shellserviceobjectdelayload')) OR contains(lower(process.cmd_line), lower('currentversion\\\\run')) OR contains(lower(process.cmd_line), lower('currentversion\\\\policies\\\\explorer\\\\run')) OR contains(lower(process.cmd_line), lower('currentcontrolset\\\\services'))))"
      }
    },
    "output": {
      "summary": "Detects the usage of \"reg.exe\" in order to query reconnaissance information from the registry. Adversaries may interact with the Windows registry to gather information about credentials, the system, configuration, and installed software.",
      "defaultContext": true
    },
    "metadata": {
      "version": 1.0,
      "severity": "Medium",
      "fidelity": "Investigative",
      "objective": "False positive: Discord Reference: https://github.com/redcanaryco/atomic-red-team/blob/f339e7da7d05f6057fdfcdd3742bfcf365fee2a9/atomics/T1012/T1012.md",
      "mitre": [
        {
          "taxonomy": "MITRE ATT&CK",
          "tactic": "Discovery",
          "techniqueId": "T1012"
        },
        {
          "taxonomy": "MITRE ATT&CK",
          "tactic": "Discovery",
          "techniqueId": "T1007"
        }
      ]
    },
    "computeMode": "high"
  },
  "apiVersion": "v1",
  "kind": "Rule"
}