{
  "metadata": {
    "name": "Potentially Suspicious Child Process Of Regsvr32",
    "comment": "Detects potentially suspicious child processes of \"regsvr32.exe\".",
    "annotations": {
      "source": "sigma",
      "category": "process_creation",
      "product": "windows",
      "sigma_status": "test"
    }
  },
  "spec": {
    "schedule": {
      "atLeastEvery": "12h",
      "enabled": false
    },
    "input": {
      "batch": {
        "sql": "SELECT * FROM process_activity WHERE time BETWEEN CURRENT_TIMESTAMP() - INTERVAL 24 HOUR AND CURRENT_TIMESTAMP() AND (activity_id = 1 AND endswith(lower(process.parent_process.name), lower('\\\\\\\\regsvr32.exe')) AND (endswith(lower(process.name), lower('\\\\\\\\calc.exe')) OR endswith(lower(process.name), lower('\\\\\\\\cscript.exe')) OR endswith(lower(process.name), lower('\\\\\\\\explorer.exe')) OR endswith(lower(process.name), lower('\\\\\\\\mshta.exe')) OR endswith(lower(process.name), lower('\\\\\\\\net.exe')) OR endswith(lower(process.name), lower('\\\\\\\\net1.exe')) OR endswith(lower(process.name), lower('\\\\\\\\nltest.exe')) OR endswith(lower(process.name), lower('\\\\\\\\notepad.exe')) OR endswith(lower(process.name), lower('\\\\\\\\powershell.exe')) OR endswith(lower(process.name), lower('\\\\\\\\pwsh.exe')) OR endswith(lower(process.name), lower('\\\\\\\\reg.exe')) OR endswith(lower(process.name), lower('\\\\\\\\schtasks.exe')) OR endswith(lower(process.name), lower('\\\\\\\\werfault.exe')) OR endswith(lower(process.name), lower('\\\\\\\\wscript.exe'))) AND NOT (endswith(lower(process.name), lower('\\\\\\\\werfault.exe')) AND contains(lower(process.cmd_line), lower(' -u -p '))))"
      }
    },
    "output": {
      "summary": "Detects potentially suspicious child processes of \"regsvr32.exe\".",
      "defaultContext": true
    },
    "metadata": {
      "version": 1.0,
      "severity": "High",
      "fidelity": "Investigative",
      "objective": "False positive: Unlikely, but can rarely occur. Apply additional filters accordingly. References: https://redcanary.com/blog/intelligence-insights-april-2022/, https://www.echotrail.io/insights/search/regsvr32.exe, https://www.ired.team/offensive-security/code-execution/t1117-regsvr32-aka-squiblydoo",
      "mitre": [
        {
          "taxonomy": "MITRE ATT&CK",
          "tactic": "Defense-Evasion",
          "techniqueId": "T1218",
          "subTechniqueId": "010"
        }
      ]
    },
    "computeMode": "high"
  },
  "apiVersion": "v1",
  "kind": "Rule"
}