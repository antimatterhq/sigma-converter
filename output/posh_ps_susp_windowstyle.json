{
  "metadata": {
    "name": "Suspicious PowerShell WindowStyle Option",
    "comment": "Adversaries may use hidden windows to conceal malicious activity from the plain sight of users. In some cases, windows that would typically be displayed when an application carries out an operation can be hidden",
    "annotations": {
      "source": "sigma",
      "category": "ps_script",
      "product": "windows",
      "sigma_status": "test"
    }
  },
  "spec": {
    "schedule": {
      "atLeastEvery": "12h",
      "enabled": false
    },
    "input": {
      "batch": {
        "sql": "SELECT * FROM script_activity WHERE time BETWEEN CURRENT_TIMESTAMP() - INTERVAL 24 HOUR AND CURRENT_TIMESTAMP() AND (contains(lower(script.script_content.value), lower('powershell')) AND contains(lower(script.script_content.value), lower('windowstyle')) AND contains(lower(script.script_content.value), lower('hidden')) AND NOT (contains(lower(script.script_content.value), lower(':\\\\\\\\program files\\\\\\\\amazon\\\\\\\\workspacesconfig\\\\\\\\scripts\\\\\\\\')) AND contains(lower(script.script_content.value), lower('$psscriptroot\\\\\\\\module\\\\\\\\workspacescriptmodule\\\\\\\\workspacescriptmodule'))))"
      }
    },
    "output": {
      "summary": "Adversaries may use hidden windows to conceal malicious activity from the plain sight of users. In some cases, windows that would typically be displayed when an application carries out an operation can be hidden",
      "defaultContext": true
    },
    "metadata": {
      "version": 1.0,
      "severity": "Medium",
      "fidelity": "Investigative",
      "objective": "False positive: Unknown Reference: https://github.com/redcanaryco/atomic-red-team/blob/f339e7da7d05f6057fdfcdd3742bfcf365fee2a9/atomics/T1564.003/T1564.003.md",
      "mitre": [
        {
          "taxonomy": "MITRE ATT&CK",
          "tactic": "Defense-Evasion",
          "techniqueId": "T1564",
          "subTechniqueId": "003"
        }
      ]
    },
    "computeMode": "high"
  },
  "apiVersion": "v1",
  "kind": "Rule"
}