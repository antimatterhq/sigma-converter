{
  "metadata": {
    "name": "HackTool - LaZagne Execution",
    "comment": "Detects the execution of the LaZagne. A utility used to retrieve multiple types of passwords stored on a local computer. LaZagne has been leveraged multiple times by threat actors in order to dump credentials.",
    "annotations": {
      "source": "sigma",
      "category": "process_creation",
      "product": "windows",
      "sigma_status": "experimental"
    }
  },
  "spec": {
    "schedule": {
      "atLeastEvery": "12h",
      "enabled": false
    },
    "input": {
      "batch": {
        "sql": "SELECT * FROM process_activity WHERE time BETWEEN CURRENT_TIMESTAMP() - INTERVAL 24 HOUR AND CURRENT_TIMESTAMP() AND (activity_id = 1 AND (endswith(lower(process.name), lower('\\\\\\\\lazagne.exe')) OR (contains(lower(process.name), lower(':\\\\\\\\perflogs\\\\\\\\')) OR contains(lower(process.name), lower(':\\\\\\\\programdata\\\\\\\\')) OR contains(lower(process.name), lower(':\\\\\\\\temp\\\\\\\\')) OR contains(lower(process.name), lower(':\\\\\\\\tmp\\\\\\\\')) OR contains(lower(process.name), lower(':\\\\\\\\windows\\\\\\\\temp\\\\\\\\')) OR contains(lower(process.name), lower('\\\\\\\\appdata\\\\\\\\')) OR contains(lower(process.name), lower('\\\\\\\\downloads\\\\\\\\')) OR contains(lower(process.name), lower('\\\\\\\\users\\\\\\\\public\\\\\\\\'))) AND (endswith(lower(process.cmd_line), lower('.exe all')) OR endswith(lower(process.cmd_line), lower('.exe browsers')) OR endswith(lower(process.cmd_line), lower('.exe chats')) OR endswith(lower(process.cmd_line), lower('.exe databases')) OR endswith(lower(process.cmd_line), lower('.exe games')) OR endswith(lower(process.cmd_line), lower('.exe git')) OR endswith(lower(process.cmd_line), lower('.exe mails')) OR endswith(lower(process.cmd_line), lower('.exe maven')) OR endswith(lower(process.cmd_line), lower('.exe memory')) OR endswith(lower(process.cmd_line), lower('.exe multimedia')) OR endswith(lower(process.cmd_line), lower('.exe sysadmin')) OR endswith(lower(process.cmd_line), lower('.exe unused')) OR endswith(lower(process.cmd_line), lower('.exe wifi')) OR endswith(lower(process.cmd_line), lower('.exe windows'))) OR (contains(lower(process.cmd_line), lower('all ')) OR contains(lower(process.cmd_line), lower('browsers ')) OR contains(lower(process.cmd_line), lower('chats ')) OR contains(lower(process.cmd_line), lower('databases ')) OR contains(lower(process.cmd_line), lower('games ')) OR contains(lower(process.cmd_line), lower('git ')) OR contains(lower(process.cmd_line), lower('mails ')) OR contains(lower(process.cmd_line), lower('maven ')) OR contains(lower(process.cmd_line), lower('memory ')) OR contains(lower(process.cmd_line), lower('multimedia ')) OR contains(lower(process.cmd_line), lower('php ')) OR contains(lower(process.cmd_line), lower('svn ')) OR contains(lower(process.cmd_line), lower('sysadmin ')) OR contains(lower(process.cmd_line), lower('unused ')) OR contains(lower(process.cmd_line), lower('wifi ')) OR contains(lower(process.cmd_line), lower('windows '))) AND (contains(lower(process.cmd_line), lower('-oa')) OR contains(lower(process.cmd_line), lower('-oj')) OR contains(lower(process.cmd_line), lower('-on')) OR contains(lower(process.cmd_line), lower('-output')) OR contains(lower(process.cmd_line), lower('-password')) OR contains(lower(process.cmd_line), lower('-1password')) OR contains(lower(process.cmd_line), lower('-apachedirectorystudio')) OR contains(lower(process.cmd_line), lower('-autologon')) OR contains(lower(process.cmd_line), lower('-chromiumbased')) OR contains(lower(process.cmd_line), lower('-composer')) OR contains(lower(process.cmd_line), lower('-coreftp')) OR contains(lower(process.cmd_line), lower('-credfiles')) OR contains(lower(process.cmd_line), lower('-credman')) OR contains(lower(process.cmd_line), lower('-cyberduck')) OR contains(lower(process.cmd_line), lower('-dbvis')) OR contains(lower(process.cmd_line), lower('-eyecon')) OR contains(lower(process.cmd_line), lower('-filezilla')) OR contains(lower(process.cmd_line), lower('-filezillaserver')) OR contains(lower(process.cmd_line), lower('-ftpnavigator')) OR contains(lower(process.cmd_line), lower('-galconfusion')) OR contains(lower(process.cmd_line), lower('-gitforwindows')) OR contains(lower(process.cmd_line), lower('-hashdump')) OR contains(lower(process.cmd_line), lower('-iisapppool')) OR contains(lower(process.cmd_line), lower('-iiscentralcertp')) OR contains(lower(process.cmd_line), lower('-kalypsomedia')) OR contains(lower(process.cmd_line), lower('-keepass')) OR contains(lower(process.cmd_line), lower('-keepassconfig')) OR contains(lower(process.cmd_line), lower('-lsa_secrets')) OR contains(lower(process.cmd_line), lower('-mavenrepositories')) OR contains(lower(process.cmd_line), lower('-memory_dump')) OR contains(lower(process.cmd_line), lower('-mozilla')) OR contains(lower(process.cmd_line), lower('-mremoteng')) OR contains(lower(process.cmd_line), lower('-mscache')) OR contains(lower(process.cmd_line), lower('-opensshforwindows')) OR contains(lower(process.cmd_line), lower('-openvpn')) OR contains(lower(process.cmd_line), lower('-outlook')) OR contains(lower(process.cmd_line), lower('-pidgin')) OR contains(lower(process.cmd_line), lower('-postgresql')) OR contains(lower(process.cmd_line), lower('-psi-im')) OR contains(lower(process.cmd_line), lower('-puttycm')) OR contains(lower(process.cmd_line), lower('-pypykatz')) OR contains(lower(process.cmd_line), lower('-rclone')) OR contains(lower(process.cmd_line), lower('-rdpmanager')) OR contains(lower(process.cmd_line), lower('-robomongo')) OR contains(lower(process.cmd_line), lower('-roguestale')) OR contains(lower(process.cmd_line), lower('-skype')) OR contains(lower(process.cmd_line), lower('-sqldeveloper')) OR contains(lower(process.cmd_line), lower('-squirrel')) OR contains(lower(process.cmd_line), lower('-tortoise')) OR contains(lower(process.cmd_line), lower('-turba')) OR contains(lower(process.cmd_line), lower('-ucbrowser')) OR contains(lower(process.cmd_line), lower('-unattended')) OR contains(lower(process.cmd_line), lower('-vault')) OR contains(lower(process.cmd_line), lower('-vaultfiles')) OR contains(lower(process.cmd_line), lower('-vnc')) OR contains(lower(process.cmd_line), lower('-windows')) OR contains(lower(process.cmd_line), lower('-winscp')) OR contains(lower(process.cmd_line), lower('-wsl')))))"
      }
    },
    "output": {
      "summary": "Detects the execution of the LaZagne. A utility used to retrieve multiple types of passwords stored on a local computer. LaZagne has been leveraged multiple times by threat actors in order to dump credentials.",
      "defaultContext": true
    },
    "metadata": {
      "version": 1.0,
      "severity": "Medium",
      "fidelity": "Investigative",
      "objective": "False positive: Some false positive is expected from tools with similar command line flags. References: https://github.com/AlessandroZ/LaZagne/tree/master, https://thedfirreport.com/2022/05/09/seo-poisoning-a-gootloader-story/, https://cloud.google.com/blog/topics/threat-intelligence/alphv-ransomware-backup/, https://securelist.com/defttorero-tactics-techniques-and-procedures/107610/, https://github.com/CyberMonitor/APT_CyberCriminal_Campagin_Collections/raw/800c0e06571993a54e39571cf27fd474dcc5c0bc/2017/2017.11.14.Muddying_the_Water/muddying-the-water-targeted-attacks.pdf",
      "mitre": [
        {
          "taxonomy": "MITRE ATT&CK",
          "tactic": "Credential-Access"
        }
      ]
    },
    "computeMode": "high"
  },
  "apiVersion": "v1",
  "kind": "Rule"
}