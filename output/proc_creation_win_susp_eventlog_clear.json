{
  "metadata": {
    "name": "Suspicious Eventlog Clearing or Configuration Change Activity",
    "comment": "Detects the clearing or configuration tampering of EventLog using utilities such as \"wevtutil\", \"powershell\" and \"wmic\". This technique were seen used by threat actors and ransomware strains in order to evade defenses.",
    "annotations": {
      "source": "sigma",
      "category": "process_creation",
      "product": "windows",
      "sigma_status": "stable"
    }
  },
  "spec": {
    "schedule": {
      "atLeastEvery": "12h",
      "enabled": false
    },
    "input": {
      "batch": {
        "sql": "SELECT * FROM process_activity WHERE time BETWEEN CURRENT_TIMESTAMP() - INTERVAL 24 HOUR AND CURRENT_TIMESTAMP() AND (lower(activity_id) = lower('1') AND (endswith(lower(process.name), lower('\\\\wevtutil.exe')) AND (contains(lower(process.cmd_line), lower('clear-log ')) OR contains(lower(process.cmd_line), lower(' cl ')) OR contains(lower(process.cmd_line), lower('set-log ')) OR contains(lower(process.cmd_line), lower(' sl ')) OR contains(lower(process.cmd_line), lower('lfn:'))) OR (endswith(lower(process.name), lower('\\\\powershell.exe')) OR endswith(lower(process.name), lower('\\\\pwsh.exe'))) AND (contains(lower(process.cmd_line), lower('clear-eventlog ')) OR contains(lower(process.cmd_line), lower('remove-eventlog ')) OR contains(lower(process.cmd_line), lower('limit-eventlog ')) OR contains(lower(process.cmd_line), lower('clear-winevent '))) OR (endswith(lower(process.name), lower('\\\\powershell.exe')) OR endswith(lower(process.name), lower('\\\\pwsh.exe')) OR endswith(lower(process.name), lower('\\\\wmic.exe'))) AND contains(lower(process.cmd_line), lower('cleareventlog'))) AND NOT ((lower(LOWER(process.parent_process.name)) in ('c:\\\\windows\\\\syswow64\\\\msiexec\\.exe', 'c:\\\\windows\\\\system32\\\\msiexec\\.exe')) AND contains(lower(process.cmd_line), lower(' sl '))))"
      }
    },
    "output": {
      "summary": "Detects the clearing or configuration tampering of EventLog using utilities such as \"wevtutil\", \"powershell\" and \"wmic\". This technique were seen used by threat actors and ransomware strains in order to evade defenses.",
      "defaultContext": true
    },
    "metadata": {
      "version": 1.0,
      "severity": "High",
      "fidelity": "Investigative",
      "objective": "False positives: 1. Admin activity 2. Scripts and administrative tools used in the monitored environment 3. Maintenance activity References: https://github.com/redcanaryco/atomic-red-team/blob/f339e7da7d05f6057fdfcdd3742bfcf365fee2a9/atomics/T1070.001/T1070.001.md, https://eqllib.readthedocs.io/en/latest/analytics/5b223758-07d6-4100-9e11-238cfdd0fe97.html, https://learn.microsoft.com/en-us/windows-server/administration/windows-commands/wevtutil, https://gist.github.com/fovtran/ac0624983c7722e80a8f5a4babb170ee, https://jdhnet.wordpress.com/2017/12/19/changing-the-location-of-the-windows-event-logs/",
      "mitre": [
        {
          "taxonomy": "MITRE ATT&CK",
          "tactic": "Defense-Evasion",
          "techniqueId": "T1070",
          "subTechniqueId": "001"
        },
        {
          "taxonomy": "MITRE ATT&CK",
          "tactic": "Defense-Evasion",
          "techniqueId": "T1562",
          "subTechniqueId": "002"
        }
      ]
    },
    "computeMode": "high"
  },
  "apiVersion": "v1",
  "kind": "Rule"
}