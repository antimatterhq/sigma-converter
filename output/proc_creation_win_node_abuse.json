{
  "metadata": {
    "name": "Potential Arbitrary Code Execution Via Node.EXE",
    "comment": "Detects the execution node.exe which is shipped with multiple software such as VMware, Adobe...etc. In order to execute arbitrary code. For example to establish reverse shell as seen in Log4j attacks...etc",
    "annotations": {
      "source": "sigma",
      "category": "process_creation",
      "product": "windows",
      "sigma_status": "test"
    }
  },
  "spec": {
    "schedule": {
      "atLeastEvery": "12h",
      "enabled": false
    },
    "input": {
      "batch": {
        "sql": "SELECT * FROM process_activity WHERE time BETWEEN CURRENT_TIMESTAMP() - INTERVAL 24 HOUR AND CURRENT_TIMESTAMP() AND (activity_id = 1 AND endswith(lower(process.name), lower('\\\\\\\\node.exe')) AND (contains(lower(process.cmd_line), lower(' -e ')) OR contains(lower(process.cmd_line), lower(' --eval '))) AND contains(lower(process.cmd_line), lower('.exec(')) AND contains(lower(process.cmd_line), lower('net.socket')) AND contains(lower(process.cmd_line), lower('.connect')) AND contains(lower(process.cmd_line), lower('child_process')))"
      }
    },
    "output": {
      "summary": "Detects the execution node.exe which is shipped with multiple software such as VMware, Adobe...etc. In order to execute arbitrary code. For example to establish reverse shell as seen in Log4j attacks...etc",
      "defaultContext": true
    },
    "metadata": {
      "version": 1.0,
      "severity": "High",
      "fidelity": "Investigative",
      "objective": "False positive: Unlikely References: http://blog.talosintelligence.com/2022/09/lazarus-three-rats.html, https://www.sprocketsecurity.com/resources/crossing-the-log4j-horizon-a-vulnerability-with-no-return, https://www.rapid7.com/blog/post/2022/01/18/active-exploitation-of-vmware-horizon-servers/, https://nodejs.org/api/cli.html",
      "mitre": [
        {
          "taxonomy": "MITRE ATT&CK",
          "tactic": "Defense-Evasion",
          "techniqueId": "T1127"
        }
      ]
    },
    "computeMode": "high"
  },
  "apiVersion": "v1",
  "kind": "Rule"
}