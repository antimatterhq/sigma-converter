{
  "metadata": {
    "name": "Suspicious LNK Double Extension File Created",
    "comment": "Detects the creation of files with an \"LNK\" as a second extension. This is sometimes used by malware as a method to abuse the fact that Windows hides the \"LNK\" extension by default.",
    "annotations": {
      "source": "sigma",
      "category": "file_event",
      "product": "windows",
      "sigma_status": "test"
    }
  },
  "spec": {
    "schedule": {
      "atLeastEvery": "12h",
      "enabled": false
    },
    "input": {
      "batch": {
        "sql": "SELECT * FROM file_activity WHERE time BETWEEN CURRENT_TIMESTAMP() - INTERVAL 24 HOUR AND CURRENT_TIMESTAMP() AND (activity_id = 1 AND endswith(lower(file.path), lower('.lnk')) AND (contains(lower(file.path), lower('.doc.')) OR contains(lower(file.path), lower('.docx.')) OR contains(lower(file.path), lower('.jpg.')) OR contains(lower(file.path), lower('.pdf.')) OR contains(lower(file.path), lower('.ppt.')) OR contains(lower(file.path), lower('.pptx.')) OR contains(lower(file.path), lower('.xls.')) OR contains(lower(file.path), lower('.xlsx.'))) AND NOT contains(lower(file.path), lower('\\\\\\\\appdata\\\\\\\\roaming\\\\\\\\microsoft\\\\\\\\windows\\\\\\\\recent\\\\\\\\')) AND NOT ((endswith(lower(actor.process.name), lower('\\\\\\\\excel.exe')) OR endswith(lower(actor.process.name), lower('\\\\\\\\powerpnt.exe')) OR endswith(lower(actor.process.name), lower('\\\\\\\\winword.exe'))) AND contains(lower(file.path), lower('\\\\\\\\appdata\\\\\\\\roaming\\\\\\\\microsoft\\\\\\\\office\\\\\\\\recent\\\\\\\\')) OR endswith(lower(actor.process.name), lower('\\\\\\\\excel.exe')) AND contains(lower(file.path), lower('\\\\\\\\appdata\\\\\\\\roaming\\\\\\\\microsoft\\\\\\\\excel')) OR endswith(lower(actor.process.name), lower('\\\\\\\\powerpnt.exe')) AND contains(lower(file.path), lower('\\\\\\\\appdata\\\\\\\\roaming\\\\\\\\microsoft\\\\\\\\powerpoint')) OR endswith(lower(actor.process.name), lower('\\\\\\\\winword.exe')) AND contains(lower(file.path), lower('\\\\\\\\appdata\\\\\\\\roaming\\\\\\\\microsoft\\\\\\\\word'))))"
      }
    },
    "output": {
      "summary": "Detects the creation of files with an \"LNK\" as a second extension. This is sometimes used by malware as a method to abuse the fact that Windows hides the \"LNK\" extension by default.",
      "defaultContext": true
    },
    "metadata": {
      "version": 1.0,
      "severity": "Medium",
      "fidelity": "Investigative",
      "objective": "False positive: Some tuning is required for other general purpose directories of third party apps References: https://www.crowdstrike.com/blog/meet-crowdstrikes-adversary-of-the-month-for-june-mustang-panda/, https://www.anomali.com/blog/china-based-apt-mustang-panda-targets-minority-groups-public-and-private-sector-organizations, https://www.cybereason.com/blog/research/a-bazar-of-tricks-following-team9s-development-cycles, https://twitter.com/malwrhunterteam/status/1235135745611960321, https://twitter.com/luc4m/status/1073181154126254080",
      "mitre": [
        {
          "taxonomy": "MITRE ATT&CK",
          "tactic": "Defense-Evasion",
          "techniqueId": "T1036",
          "subTechniqueId": "007"
        }
      ]
    },
    "computeMode": "high"
  },
  "apiVersion": "v1",
  "kind": "Rule"
}