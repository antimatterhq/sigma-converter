{
  "metadata": {
    "name": "AWS Key Pair Import Activity",
    "comment": "Detects the import of SSH key pairs into AWS EC2, which may indicate an attacker attempting to gain unauthorized access to instances. This activity could lead to initial access, persistence, or privilege escalation, potentially compromising sensitive data and operations.",
    "annotations": {
      "source": "sigma",
      "product": "aws",
      "service": "cloudtrail",
      "sigma_status": "experimental"
    }
  },
  "spec": {
    "schedule": {
      "atLeastEvery": "15m",
      "enabled": true
    },
    "input": {
      "batch": {
        "sql": "SELECT * FROM file_activity WHERE time BETWEEN CURRENT_TIMESTAMP() - INTERVAL 24 HOUR AND CURRENT_TIMESTAMP() AND (lower(metadata.product.name) = lower('ec2.amazonaws.com') AND lower(metadata.event_code) = lower('importkeypair'))"
      }
    },
    "output": {
      "summary": "Detects the import of SSH key pairs into AWS EC2, which may indicate an attacker attempting to gain unauthorized access to instances. This activity could lead to initial access, persistence, or privilege escalation, potentially compromising sensitive data and operations.",
      "defaultContext": true
    },
    "metadata": {
      "version": 1.0,
      "severity": "Medium",
      "fidelity": "Investigative",
      "objective": "False positives: 1. Legitimate administrative actions by authorized users importing keys for valid purposes. 2. Automated processes for infrastructure setup may trigger this alert. 3. Verify the user identity, user agent, and source IP address to ensure they are expected. Reference: https://docs.aws.amazon.com/AWSEC2/latest/APIReference/API_ImportKeyPair.html",
      "mitre": [
        {
          "taxonomy": "MITRE ATT&CK",
          "tactic": "Initial-Access",
          "techniqueId": "T1078"
        }
      ]
    },
    "computeMode": "high"
  },
  "apiVersion": "v1",
  "kind": "Rule"
}