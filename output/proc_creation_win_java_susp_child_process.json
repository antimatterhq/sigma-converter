{
  "metadata": {
    "name": "Suspicious Processes Spawned by Java.EXE",
    "comment": "Detects suspicious processes spawned from a Java host process which could indicate a sign of exploitation (e.g. log4j)",
    "annotations": {
      "source": "sigma",
      "category": "process_creation",
      "product": "windows",
      "sigma_status": "test"
    }
  },
  "spec": {
    "schedule": {
      "atLeastEvery": "12h",
      "enabled": false
    },
    "input": {
      "batch": {
        "sql": "SELECT * FROM process_activity WHERE time BETWEEN CURRENT_TIMESTAMP() - INTERVAL 24 HOUR AND CURRENT_TIMESTAMP() AND (activity_id = 1 AND endswith(lower(process.parent_process.name), lower('\\\\\\\\java.exe')) AND (endswith(lower(process.name), lower('\\\\\\\\appvlp.exe')) OR endswith(lower(process.name), lower('\\\\\\\\bitsadmin.exe')) OR endswith(lower(process.name), lower('\\\\\\\\certutil.exe')) OR endswith(lower(process.name), lower('\\\\\\\\cscript.exe')) OR endswith(lower(process.name), lower('\\\\\\\\curl.exe')) OR endswith(lower(process.name), lower('\\\\\\\\forfiles.exe')) OR endswith(lower(process.name), lower('\\\\\\\\hh.exe')) OR endswith(lower(process.name), lower('\\\\\\\\mftrace.exe')) OR endswith(lower(process.name), lower('\\\\\\\\mshta.exe')) OR endswith(lower(process.name), lower('\\\\\\\\net.exe')) OR endswith(lower(process.name), lower('\\\\\\\\net1.exe')) OR endswith(lower(process.name), lower('\\\\\\\\query.exe')) OR endswith(lower(process.name), lower('\\\\\\\\reg.exe')) OR endswith(lower(process.name), lower('\\\\\\\\regsvr32.exe')) OR endswith(lower(process.name), lower('\\\\\\\\rundll32.exe')) OR endswith(lower(process.name), lower('\\\\\\\\schtasks.exe')) OR endswith(lower(process.name), lower('\\\\\\\\scrcons.exe')) OR endswith(lower(process.name), lower('\\\\\\\\scriptrunner.exe')) OR endswith(lower(process.name), lower('\\\\\\\\sh.exe')) OR endswith(lower(process.name), lower('\\\\\\\\systeminfo.exe')) OR endswith(lower(process.name), lower('\\\\\\\\whoami.exe')) OR endswith(lower(process.name), lower('\\\\\\\\wmic.exe')) OR endswith(lower(process.name), lower('\\\\\\\\wscript.exe'))))"
      }
    },
    "output": {
      "summary": "Detects suspicious processes spawned from a Java host process which could indicate a sign of exploitation (e.g. log4j)",
      "defaultContext": true
    },
    "metadata": {
      "version": 1.0,
      "severity": "High",
      "fidelity": "Investigative",
      "objective": "False positives: 1. Legitimate calls to system binaries 2. Company specific internal usage Reference: https://web.archive.org/web/20231230220738/https://www.lunasec.io/docs/blog/log4j-zero-day/",
      "mitre": [
        {
          "taxonomy": "MITRE ATT&CK",
          "tactic": "Initial-Access"
        },
        {
          "taxonomy": "MITRE ATT&CK",
          "tactic": "Persistence"
        },
        {
          "taxonomy": "MITRE ATT&CK",
          "tactic": "Privilege-Escalation"
        }
      ]
    },
    "computeMode": "high"
  },
  "apiVersion": "v1",
  "kind": "Rule"
}