{
  "metadata": {
    "name": "Uncommon File Created In Office Startup Folder",
    "comment": "Detects the creation of a file with an uncommon extension in an Office application startup folder",
    "annotations": {
      "source": "sigma",
      "category": "file_event",
      "product": "windows",
      "sigma_status": "test"
    }
  },
  "spec": {
    "schedule": {
      "atLeastEvery": "12h",
      "enabled": false
    },
    "input": {
      "batch": {
        "sql": "SELECT * FROM file_activity WHERE time BETWEEN CURRENT_TIMESTAMP() - INTERVAL 24 HOUR AND CURRENT_TIMESTAMP() AND (lower(activity_id) = lower('1') AND (contains(lower(file.path), lower('\\\\microsoft\\\\word\\\\startup')) AND contains(lower(file.path), lower('\\\\office')) AND contains(lower(file.path), lower('\\\\program files')) AND contains(lower(file.path), lower('\\\\startup')) AND NOT (endswith(lower(file.path), lower('.docb')) OR endswith(lower(file.path), lower('.docm')) OR endswith(lower(file.path), lower('.docx')) OR endswith(lower(file.path), lower('.dotm')) OR endswith(lower(file.path), lower('.mdb')) OR endswith(lower(file.path), lower('.mdw')) OR endswith(lower(file.path), lower('.pdf')) OR endswith(lower(file.path), lower('.wll')) OR endswith(lower(file.path), lower('.wwl'))) OR contains(lower(file.path), lower('\\\\microsoft\\\\excel\\\\xlstart')) AND contains(lower(file.path), lower('\\\\office')) AND contains(lower(file.path), lower('\\\\program files')) AND contains(lower(file.path), lower('\\\\xlstart')) AND NOT (endswith(lower(file.path), lower('.xll')) OR endswith(lower(file.path), lower('.xls')) OR endswith(lower(file.path), lower('.xlsm')) OR endswith(lower(file.path), lower('.xlsx')) OR endswith(lower(file.path), lower('.xlt')) OR endswith(lower(file.path), lower('.xltm')) OR endswith(lower(file.path), lower('.xlw')))) AND NOT (contains(lower(actor.process.name), lower(':\\\\program files\\\\common files\\\\microsoft shared\\\\clicktorun\\\\')) AND endswith(lower(actor.process.name), lower('\\\\officeclicktorun.exe')) OR (contains(lower(actor.process.name), lower(':\\\\program files\\\\microsoft office\\\\')) OR contains(lower(actor.process.name), lower(':\\\\program files (x86)\\\\microsoft office\\\\'))) AND (endswith(lower(actor.process.name), lower('\\\\winword.exe')) OR endswith(lower(actor.process.name), lower('\\\\excel.exe')))))"
      }
    },
    "output": {
      "summary": "Detects the creation of a file with an uncommon extension in an Office application startup folder",
      "defaultContext": true
    },
    "metadata": {
      "version": 1.0,
      "severity": "High",
      "fidelity": "Investigative",
      "objective": "False positive: False positive might stem from rare extensions used by other Office utilities. References: https://app.any.run/tasks/d6fe6624-6ef8-485d-aa75-3d1bdda2a08c/, http://addbalance.com/word/startup.htm, https://answers.microsoft.com/en-us/msoffice/forum/all/document-in-word-startup-folder-doesnt-open-when/44ab0932-2917-4150-8cdc-2f2cf39e86f3, https://en.wikipedia.org/wiki/List_of_Microsoft_Office_filename_extensions",
      "mitre": [
        {
          "taxonomy": "MITRE ATT&CK",
          "tactic": "Resource-Development",
          "techniqueId": "T1587",
          "subTechniqueId": "001"
        }
      ]
    },
    "computeMode": "high"
  },
  "apiVersion": "v1",
  "kind": "Rule"
}