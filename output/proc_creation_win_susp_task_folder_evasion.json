{
  "metadata": {
    "name": "Tasks Folder Evasion",
    "comment": "The Tasks folder in system32 and syswow64 are globally writable paths. Adversaries can take advantage of this and load or influence any script hosts or ANY .NET Application in Tasks to load and execute a custom assembly into cscript, wscript, regsvr32, mshta, eventvwr",
    "annotations": {
      "source": "sigma",
      "category": "process_creation",
      "product": "windows",
      "sigma_status": "test"
    }
  },
  "spec": {
    "schedule": {
      "atLeastEvery": "15m",
      "enabled": true
    },
    "input": {
      "batch": {
        "sql": "SELECT * FROM process_activity WHERE time BETWEEN CURRENT_TIMESTAMP() - INTERVAL 24 HOUR AND CURRENT_TIMESTAMP() AND (lower(activity_id) = lower('1') AND (contains(lower(process.cmd_line), lower('echo ')) OR contains(lower(process.cmd_line), lower('copy ')) OR contains(lower(process.cmd_line), lower('type ')) OR contains(lower(process.cmd_line), lower('file createnew'))) AND (contains(lower(process.cmd_line), lower(' c:\\\\windows\\\\system32\\\\tasks\\\\')) OR contains(lower(process.cmd_line), lower(' c:\\\\windows\\\\syswow64\\\\tasks\\\\'))))"
      }
    },
    "output": {
      "summary": "The Tasks folder in system32 and syswow64 are globally writable paths. Adversaries can take advantage of this and load or influence any script hosts or ANY .NET Application in Tasks to load and execute a custom assembly into cscript, wscript, regsvr32, mshta, eventvwr",
      "defaultContext": true
    },
    "metadata": {
      "version": 1.0,
      "severity": "High",
      "fidelity": "Investigative",
      "objective": "Examine fields: process.cmd_line, ParentProcess False positive: Unknown References: https://twitter.com/subTee/status/1216465628946563073, https://gist.github.com/am0nsec/8378da08f848424e4ab0cc5b317fdd26",
      "mitre": [
        {
          "taxonomy": "MITRE ATT&CK",
          "tactic": "Defense-Evasion",
          "techniqueId": "T1574",
          "subTechniqueId": "002"
        }
      ]
    },
    "computeMode": "high"
  },
  "apiVersion": "v1",
  "kind": "Rule"
}