{
  "metadata": {
    "name": "System Information Discovery Via Sysctl - MacOS",
    "comment": "Detects the execution of \"sysctl\" with specific arguments that have been used by threat actors and malware. It provides system hardware information. This process is primarily used to detect and avoid virtualization and analysis environments.",
    "annotations": {
      "source": "sigma",
      "category": "process_creation",
      "product": "macos",
      "sigma_status": "experimental"
    }
  },
  "spec": {
    "schedule": {
      "atLeastEvery": "12h",
      "enabled": false
    },
    "input": {
      "batch": {
        "sql": "SELECT * FROM process_activity WHERE time BETWEEN CURRENT_TIMESTAMP() - INTERVAL 24 HOUR AND CURRENT_TIMESTAMP() AND (activity_id = 1 AND endswith(lower(process.name), lower('/sysctl')) AND contains(lower(process.cmd_line), lower('sysctl')) AND (contains(lower(process.cmd_line), lower('hw.')) OR contains(lower(process.cmd_line), lower('kern.')) OR contains(lower(process.cmd_line), lower('machdep.'))))"
      }
    },
    "output": {
      "summary": "Detects the execution of \"sysctl\" with specific arguments that have been used by threat actors and malware. It provides system hardware information. This process is primarily used to detect and avoid virtualization and analysis environments.",
      "defaultContext": true
    },
    "metadata": {
      "version": 1.0,
      "severity": "Medium",
      "fidelity": "Investigative",
      "objective": "False positive: Legitimate administrative activities References: https://www.loobins.io/binaries/sysctl/#, https://evasions.checkpoint.com/techniques/macos.html, https://www.welivesecurity.com/2019/04/09/oceanlotus-macos-malware-update/, https://www.sentinelone.com/labs/20-common-tools-techniques-used-by-macos-threat-actors-malware/, https://objective-see.org/blog/blog_0x1E.html, https://www.virustotal.com/gui/file/1c547a064494a35d6b5e6b459de183ab2720a22725e082bed6f6629211f7abc1/behavior, https://www.virustotal.com/gui/file/b4b1fc65f87b3dcfa35e2dbe8e0a34ad9d8a400bec332025c0a2e200671038aa/behavior",
      "mitre": [
        {
          "taxonomy": "MITRE ATT&CK",
          "tactic": "Defense-Evasion",
          "techniqueId": "T1497",
          "subTechniqueId": "001"
        },
        {
          "taxonomy": "MITRE ATT&CK",
          "tactic": "Defense-Evasion",
          "techniqueId": "T1082"
        }
      ]
    },
    "computeMode": "high"
  },
  "apiVersion": "v1",
  "kind": "Rule"
}