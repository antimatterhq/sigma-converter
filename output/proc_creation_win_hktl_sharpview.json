{
  "metadata": {
    "name": "HackTool - SharpView Execution",
    "comment": "Adversaries may look for details about the network configuration and settings of systems they access or through information discovery of remote systems",
    "annotations": {
      "source": "sigma",
      "category": "process_creation",
      "product": "windows",
      "sigma_status": "test"
    }
  },
  "spec": {
    "schedule": {
      "atLeastEvery": "15m",
      "enabled": true
    },
    "input": {
      "batch": {
        "sql": "SELECT * FROM process_activity WHERE time BETWEEN CURRENT_TIMESTAMP() - INTERVAL 24 HOUR AND CURRENT_TIMESTAMP() AND (lower(activity_id) = lower('1') AND lower(process.file.name) = lower('sharpview.exe') AND endswith(lower(process.name), lower('\\\\sharpview.exe')) AND (contains(lower(process.cmd_line), lower('add-remoteconnection')) OR contains(lower(process.cmd_line), lower('convert-adname')) OR contains(lower(process.cmd_line), lower('convertfrom-sid')) OR contains(lower(process.cmd_line), lower('convertfrom-uacvalue')) OR contains(lower(process.cmd_line), lower('convert-sidtoname')) OR contains(lower(process.cmd_line), lower('export-powerviewcsv')) OR contains(lower(process.cmd_line), lower('find-domainobjectpropertyoutlier')) OR contains(lower(process.cmd_line), lower('find-domainprocess')) OR contains(lower(process.cmd_line), lower('find-domainshare')) OR contains(lower(process.cmd_line), lower('find-domainuserevent')) OR contains(lower(process.cmd_line), lower('find-domainuserlocation')) OR contains(lower(process.cmd_line), lower('find-foreigngroup')) OR contains(lower(process.cmd_line), lower('find-foreignuser')) OR contains(lower(process.cmd_line), lower('find-gpocomputeradmin')) OR contains(lower(process.cmd_line), lower('find-gpolocation')) OR contains(lower(process.cmd_line), lower('find-interesting')) OR contains(lower(process.cmd_line), lower('find-localadminaccess')) OR contains(lower(process.cmd_line), lower('find-managedsecuritygroups')) OR contains(lower(process.cmd_line), lower('get-cachedrdpconnection')) OR contains(lower(process.cmd_line), lower('get-dfsshare')) OR contains(lower(process.cmd_line), lower('get-domaincomputer')) OR contains(lower(process.cmd_line), lower('get-domaincontroller')) OR contains(lower(process.cmd_line), lower('get-domaindfsshare')) OR contains(lower(process.cmd_line), lower('get-domaindnsrecord')) OR contains(lower(process.cmd_line), lower('get-domainfileserver')) OR contains(lower(process.cmd_line), lower('get-domainforeign')) OR contains(lower(process.cmd_line), lower('get-domaingpo')) OR contains(lower(process.cmd_line), lower('get-domaingroup')) OR contains(lower(process.cmd_line), lower('get-domainguidmap')) OR contains(lower(process.cmd_line), lower('get-domainmanagedsecuritygroup')) OR contains(lower(process.cmd_line), lower('get-domainobject')) OR contains(lower(process.cmd_line), lower('get-domainou')) OR contains(lower(process.cmd_line), lower('get-domainpolicy')) OR contains(lower(process.cmd_line), lower('get-domainsid')) OR contains(lower(process.cmd_line), lower('get-domainsite')) OR contains(lower(process.cmd_line), lower('get-domainspnticket')) OR contains(lower(process.cmd_line), lower('get-domainsubnet')) OR contains(lower(process.cmd_line), lower('get-domaintrust')) OR contains(lower(process.cmd_line), lower('get-domainuserevent')) OR contains(lower(process.cmd_line), lower('get-forestdomain')) OR contains(lower(process.cmd_line), lower('get-forestglobalcatalog')) OR contains(lower(process.cmd_line), lower('get-foresttrust')) OR contains(lower(process.cmd_line), lower('get-gpttmpl')) OR contains(lower(process.cmd_line), lower('get-groupsxml')) OR contains(lower(process.cmd_line), lower('get-lastloggedon')) OR contains(lower(process.cmd_line), lower('get-loggedonlocal')) OR contains(lower(process.cmd_line), lower('get-netcomputer')) OR contains(lower(process.cmd_line), lower('get-netdomain')) OR contains(lower(process.cmd_line), lower('get-netfileserver')) OR contains(lower(process.cmd_line), lower('get-netforest')) OR contains(lower(process.cmd_line), lower('get-netgpo')) OR contains(lower(process.cmd_line), lower('get-netgroupmember')) OR contains(lower(process.cmd_line), lower('get-netlocalgroup')) OR contains(lower(process.cmd_line), lower('get-netloggedon')) OR contains(lower(process.cmd_line), lower('get-netou')) OR contains(lower(process.cmd_line), lower('get-netprocess')) OR contains(lower(process.cmd_line), lower('get-netrdpsession')) OR contains(lower(process.cmd_line), lower('get-netsession')) OR contains(lower(process.cmd_line), lower('get-netshare')) OR contains(lower(process.cmd_line), lower('get-netsite')) OR contains(lower(process.cmd_line), lower('get-netsubnet')) OR contains(lower(process.cmd_line), lower('get-netuser')) OR contains(lower(process.cmd_line), lower('get-pathacl')) OR contains(lower(process.cmd_line), lower('get-principalcontext')) OR contains(lower(process.cmd_line), lower('get-registrymounteddrive')) OR contains(lower(process.cmd_line), lower('get-regloggedon')) OR contains(lower(process.cmd_line), lower('get-wmiregcachedrdpconnection')) OR contains(lower(process.cmd_line), lower('get-wmireglastloggedon')) OR contains(lower(process.cmd_line), lower('get-wmiregmounteddrive')) OR contains(lower(process.cmd_line), lower('get-wmiregproxy')) OR contains(lower(process.cmd_line), lower('invoke-aclscanner')) OR contains(lower(process.cmd_line), lower('invoke-checklocaladminaccess')) OR contains(lower(process.cmd_line), lower('invoke-kerberoast')) OR contains(lower(process.cmd_line), lower('invoke-mapdomaintrust')) OR contains(lower(process.cmd_line), lower('invoke-reverttoself')) OR contains(lower(process.cmd_line), lower('invoke-sharefinder')) OR contains(lower(process.cmd_line), lower('invoke-userimpersonation')) OR contains(lower(process.cmd_line), lower('remove-domainobjectacl')) OR contains(lower(process.cmd_line), lower('remove-remoteconnection')) OR contains(lower(process.cmd_line), lower('request-spnticket')) OR contains(lower(process.cmd_line), lower('set-domainobject')) OR contains(lower(process.cmd_line), lower('test-adminaccess'))))"
      }
    },
    "output": {
      "summary": "Adversaries may look for details about the network configuration and settings of systems they access or through information discovery of remote systems",
      "defaultContext": true
    },
    "metadata": {
      "version": 1.0,
      "severity": "High",
      "fidelity": "Investigative",
      "objective": "False positive: Unknown References: https://github.com/tevora-threat/SharpView/, https://github.com/PowerShellMafia/PowerSploit/blob/dev/Recon/PowerView.ps1, https://github.com/redcanaryco/atomic-red-team/blob/f339e7da7d05f6057fdfcdd3742bfcf365fee2a9/atomics/T1049/T1049.md#atomic-test-4---system-discovery-using-sharpview",
      "mitre": [
        {
          "taxonomy": "MITRE ATT&CK",
          "tactic": "Discovery",
          "techniqueId": "T1049"
        },
        {
          "taxonomy": "MITRE ATT&CK",
          "tactic": "Discovery",
          "techniqueId": "T1069",
          "subTechniqueId": "002"
        },
        {
          "taxonomy": "MITRE ATT&CK",
          "tactic": "Discovery",
          "techniqueId": "T1482"
        },
        {
          "taxonomy": "MITRE ATT&CK",
          "tactic": "Discovery",
          "techniqueId": "T1135"
        },
        {
          "taxonomy": "MITRE ATT&CK",
          "tactic": "Discovery",
          "techniqueId": "T1033"
        }
      ]
    },
    "computeMode": "high"
  },
  "apiVersion": "v1",
  "kind": "Rule"
}