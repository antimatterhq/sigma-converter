{
  "metadata": {
    "name": "AWS SAML Provider Deletion Activity",
    "comment": "Detects the deletion of an AWS SAML provider, potentially indicating malicious intent to disrupt administrative or security team access. An attacker can remove the SAML provider for the information security team or a team of system administrators, to make it difficult for them to work and investigate at the time of the attack and after it.",
    "annotations": {
      "source": "sigma",
      "product": "aws",
      "service": "cloudtrail",
      "sigma_status": "experimental"
    }
  },
  "spec": {
    "schedule": {
      "atLeastEvery": "12h",
      "enabled": false
    },
    "input": {
      "batch": {
        "sql": "SELECT * FROM authentication WHERE time BETWEEN CURRENT_TIMESTAMP() - INTERVAL 24 HOUR AND CURRENT_TIMESTAMP() AND (lower(metadata.product.name) = lower('iam.amazonaws.com') AND lower(metadata.event_code) = lower('deletesamlprovider') AND lower(actor.authorizations.decision) = lower('success'))"
      }
    },
    "output": {
      "summary": "Detects the deletion of an AWS SAML provider, potentially indicating malicious intent to disrupt administrative or security team access. An attacker can remove the SAML provider for the information security team or a team of system administrators, to make it difficult for them to work and investigate at the time of the attack and after it.",
      "defaultContext": true
    },
    "metadata": {
      "version": 1.0,
      "severity": "Medium",
      "fidelity": "Investigative",
      "objective": "False positives: 1. Automated processes using tools like Terraform may trigger this alert. 2. Legitimate administrative actions by authorized system administrators could cause this alert. Verify the user identity, user agent, and hostname to ensure they are expected. 3. Deletions by unfamiliar users should be investigated. If the behavior is known and expected, it can be exempted from the rule. Reference: https://docs.aws.amazon.com/IAM/latest/APIReference/API_DeleteSAMLProvider.html",
      "mitre": [
        {
          "taxonomy": "MITRE ATT&CK",
          "tactic": "Privilege-Escalation",
          "techniqueId": "T1078",
          "subTechniqueId": "004"
        },
        {
          "taxonomy": "MITRE ATT&CK",
          "tactic": "Privilege-Escalation",
          "techniqueId": "T1531"
        }
      ]
    },
    "computeMode": "high"
  },
  "apiVersion": "v1",
  "kind": "Rule"
}