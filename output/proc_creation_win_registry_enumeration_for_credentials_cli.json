{
  "metadata": {
    "name": "Enumeration for 3rd Party Creds From CLI",
    "comment": "Detects processes that query known 3rd party registry keys that holds credentials via commandline",
    "annotations": {
      "source": "sigma",
      "category": "process_creation",
      "product": "windows",
      "sigma_status": "test"
    }
  },
  "spec": {
    "schedule": {
      "atLeastEvery": "12h",
      "enabled": false
    },
    "input": {
      "batch": {
        "sql": "SELECT * FROM process_activity WHERE time BETWEEN CURRENT_TIMESTAMP() - INTERVAL 24 HOUR AND CURRENT_TIMESTAMP() AND (activity_id = 1 AND (contains(lower(process.cmd_line), lower('\\\\\\\\software\\\\\\\\simontatham\\\\\\\\putty\\\\\\\\sessions')) OR contains(lower(process.cmd_line), lower('\\\\\\\\software\\\\\\\\simontatham\\\\\\\\putty\\\\\\\\sshhostkeys\\\\\\\\')) OR contains(lower(process.cmd_line), lower('\\\\\\\\software\\\\\\\\mobatek\\\\\\\\mobaxterm\\\\\\\\')) OR contains(lower(process.cmd_line), lower('\\\\\\\\software\\\\\\\\wow6432node\\\\\\\\radmin\\\\\\\\v3.0\\\\\\\\server\\\\\\\\parameters\\\\\\\\radmin')) OR contains(lower(process.cmd_line), lower('\\\\\\\\software\\\\\\\\aerofox\\\\\\\\foxmailpreview')) OR contains(lower(process.cmd_line), lower('\\\\\\\\software\\\\\\\\aerofox\\\\\\\\foxmail\\\\\\\\v3.1')) OR contains(lower(process.cmd_line), lower('\\\\\\\\software\\\\\\\\incredimail\\\\\\\\identities')) OR contains(lower(process.cmd_line), lower('\\\\\\\\software\\\\\\\\qualcomm\\\\\\\\eudora\\\\\\\\commandline')) OR contains(lower(process.cmd_line), lower('\\\\\\\\software\\\\\\\\rimarts\\\\\\\\b2\\\\\\\\settings')) OR contains(lower(process.cmd_line), lower('\\\\\\\\software\\\\\\\\openvpn-gui\\\\\\\\configs')) OR contains(lower(process.cmd_line), lower('\\\\\\\\software\\\\\\\\martin prikryl\\\\\\\\winscp 2\\\\\\\\sessions')) OR contains(lower(process.cmd_line), lower('\\\\\\\\software\\\\\\\\ftpware\\\\\\\\coreftp\\\\\\\\sites')) OR contains(lower(process.cmd_line), lower('\\\\\\\\software\\\\\\\\downloadmanager\\\\\\\\passwords')) OR contains(lower(process.cmd_line), lower('\\\\\\\\software\\\\\\\\openssh\\\\\\\\agent\\\\\\\\keys')) OR contains(lower(process.cmd_line), lower('\\\\\\\\software\\\\\\\\tightvnc\\\\\\\\server')) OR contains(lower(process.cmd_line), lower('\\\\\\\\software\\\\\\\\orl\\\\\\\\winvnc3\\\\\\\\password')) OR contains(lower(process.cmd_line), lower('\\\\\\\\software\\\\\\\\realvnc\\\\\\\\winvnc4'))))"
      }
    },
    "output": {
      "summary": "Detects processes that query known 3rd party registry keys that holds credentials via commandline",
      "defaultContext": true
    },
    "metadata": {
      "version": 1.0,
      "severity": "Medium",
      "fidelity": "Investigative",
      "objective": "False positive: Unknown References: https://isc.sans.edu/diary/More+Data+Exfiltration/25698, https://github.com/synacktiv/Radmin3-Password-Cracker/blob/acfc87393e4b7c06353973a14a6c7126a51f36ac/regkey.txt, https://github.com/HyperSine/how-does-MobaXterm-encrypt-password, https://book.hacktricks.xyz/windows-hardening/windows-local-privilege-escalation#inside-the-registry",
      "mitre": [
        {
          "taxonomy": "MITRE ATT&CK",
          "tactic": "Credential-Access",
          "techniqueId": "T1552",
          "subTechniqueId": "002"
        }
      ]
    },
    "computeMode": "high"
  },
  "apiVersion": "v1",
  "kind": "Rule"
}