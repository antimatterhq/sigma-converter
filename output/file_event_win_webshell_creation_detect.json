{
  "metadata": {
    "name": "Potential Webshell Creation On Static Website",
    "comment": "Detects the creation of files with certain extensions on a static web site. This can be indicative of potential uploads of a web shell.",
    "annotations": {
      "source": "sigma",
      "category": "file_event",
      "product": "windows",
      "sigma_status": "test"
    }
  },
  "spec": {
    "schedule": {
      "atLeastEvery": "15m",
      "enabled": true
    },
    "input": {
      "batch": {
        "sql": "SELECT * FROM file_activity WHERE time BETWEEN CURRENT_TIMESTAMP() - INTERVAL 24 HOUR AND CURRENT_TIMESTAMP() AND (lower(activity_id) = lower('1') AND (contains(lower(file.path), lower('\\\\inetpub\\\\wwwroot\\\\')) AND (contains(lower(file.path), lower('.ashx')) OR contains(lower(file.path), lower('.asp')) OR contains(lower(file.path), lower('.ph')) OR contains(lower(file.path), lower('.soap'))) OR (contains(lower(file.path), lower('\\\\www\\\\')) OR contains(lower(file.path), lower('\\\\htdocs\\\\')) OR contains(lower(file.path), lower('\\\\html\\\\'))) AND contains(lower(file.path), lower('.ph'))) AND NOT (contains(lower(file.path), lower('\\\\appdata\\\\local\\\\temp\\\\')) OR contains(lower(file.path), lower('\\\\windows\\\\temp\\\\')) OR lower(actor.process.name) = lower('system') OR contains(lower(file.path), lower('\\\\xampp'))))"
      }
    },
    "output": {
      "summary": "Detects the creation of files with certain extensions on a static web site. This can be indicative of potential uploads of a web shell.",
      "defaultContext": true
    },
    "metadata": {
      "version": 1.0,
      "severity": "Medium",
      "fidelity": "Investigative",
      "objective": "False positive: Legitimate administrator or developer creating legitimate executable files in a web application folder References: PT ESC rule and personal experience, https://github.com/swisskyrepo/PayloadsAllTheThings/blob/c95a0a1a2855dc0cd7f7327614545fe30482a636/Upload%20Insecure%20Files/README.md",
      "mitre": [
        {
          "taxonomy": "MITRE ATT&CK",
          "tactic": "Persistence",
          "techniqueId": "T1505",
          "subTechniqueId": "003"
        }
      ]
    },
    "computeMode": "high"
  },
  "apiVersion": "v1",
  "kind": "Rule"
}