{
  "metadata": {
    "name": "Hacktool Execution - Imphash",
    "comment": "Detects the execution of different Windows based hacktools via their import hash (imphash) even if the files have been renamed",
    "annotations": {
      "source": "sigma",
      "category": "process_creation",
      "product": "windows",
      "sigma_status": "test"
    }
  },
  "spec": {
    "schedule": {
      "atLeastEvery": "12h",
      "enabled": false
    },
    "input": {
      "batch": {
        "sql": "SELECT * FROM process_activity WHERE time BETWEEN CURRENT_TIMESTAMP() - INTERVAL 24 HOUR AND CURRENT_TIMESTAMP() AND (activity_id = 1 AND (contains(lower(process.file.hashes.value), lower('imphash=bcca3c247b619dcd13c8cdff5f123932')) OR contains(lower(process.file.hashes.value), lower('imphash=3a19059bd7688cb88e70005f18efc439')) OR contains(lower(process.file.hashes.value), lower('imphash=bf6223a49e45d99094406777eb6004ba')) OR contains(lower(process.file.hashes.value), lower('imphash=23867a89c2b8fc733be6cf5ef902f2d1')) OR contains(lower(process.file.hashes.value), lower('imphash=a37ff327f8d48e8a4d2f757e1b6e70bc')) OR contains(lower(process.file.hashes.value), lower('imphash=f9a28c458284584a93b14216308d31bd')) OR contains(lower(process.file.hashes.value), lower('imphash=6118619783fc175bc7ebecff0769b46e')) OR contains(lower(process.file.hashes.value), lower('imphash=959a83047e80ab68b368fdb3f4c6e4ea')) OR contains(lower(process.file.hashes.value), lower('imphash=563233bfa169acc7892451f71ad5850a')) OR contains(lower(process.file.hashes.value), lower('imphash=87575cb7a0e0700eb37f2e3668671a08')) OR contains(lower(process.file.hashes.value), lower('imphash=13f08707f759af6003837a150a371ba1')) OR contains(lower(process.file.hashes.value), lower('imphash=1781f06048a7e58b323f0b9259be798b')) OR contains(lower(process.file.hashes.value), lower('imphash=233f85f2d4bc9d6521a6caae11a1e7f5')) OR contains(lower(process.file.hashes.value), lower('imphash=24af2584cbf4d60bbe5c6d1b31b3be6d')) OR contains(lower(process.file.hashes.value), lower('imphash=632969ddf6dbf4e0f53424b75e4b91f2')) OR contains(lower(process.file.hashes.value), lower('imphash=713c29b396b907ed71a72482759ed757')) OR contains(lower(process.file.hashes.value), lower('imphash=749a7bb1f0b4c4455949c0b2bf7f9e9f')) OR contains(lower(process.file.hashes.value), lower('imphash=8628b2608957a6b0c6330ac3de28ce2e')) OR contains(lower(process.file.hashes.value), lower('imphash=8b114550386e31895dfab371e741123d')) OR contains(lower(process.file.hashes.value), lower('imphash=94cb940a1a6b65bed4d5a8f849ce9793')) OR contains(lower(process.file.hashes.value), lower('imphash=9d68781980370e00e0bd939ee5e6c141')) OR contains(lower(process.file.hashes.value), lower('imphash=b18a1401ff8f444056d29450fbc0a6ce')) OR contains(lower(process.file.hashes.value), lower('imphash=cb567f9498452721d77a451374955f5f')) OR contains(lower(process.file.hashes.value), lower('imphash=730073214094cd328547bf1f72289752')) OR contains(lower(process.file.hashes.value), lower('imphash=17b461a082950fc6332228572138b80c')) OR contains(lower(process.file.hashes.value), lower('imphash=dc25ee78e2ef4d36faa0badf1e7461c9')) OR contains(lower(process.file.hashes.value), lower('imphash=819b19d53ca6736448f9325a85736792')) OR contains(lower(process.file.hashes.value), lower('imphash=829da329ce140d873b4a8bde2cbfaa7e')) OR contains(lower(process.file.hashes.value), lower('imphash=c547f2e66061a8dffb6f5a3ff63c0a74')) OR contains(lower(process.file.hashes.value), lower('imphash=0588081ab0e63ba785938467e1b10cca')) OR contains(lower(process.file.hashes.value), lower('imphash=0d9ec08bac6c07d9987dfd0f1506587c')) OR contains(lower(process.file.hashes.value), lower('imphash=bc129092b71c89b4d4c8cdf8ea590b29')) OR contains(lower(process.file.hashes.value), lower('imphash=4da924cf622d039d58bce71cdf05d242')) OR contains(lower(process.file.hashes.value), lower('imphash=e7a3a5c377e2d29324093377d7db1c66')) OR contains(lower(process.file.hashes.value), lower('imphash=9a9dbec5c62f0380b4fa5fd31deffedf')) OR contains(lower(process.file.hashes.value), lower('imphash=af8a3976ad71e5d5fdfb67ddb8dadfce')) OR contains(lower(process.file.hashes.value), lower('imphash=0c477898bbf137bbd6f2a54e3b805ff4')) OR contains(lower(process.file.hashes.value), lower('imphash=0ca9f02b537bcea20d4ea5eb1a9fe338')) OR contains(lower(process.file.hashes.value), lower('imphash=3ab3655e5a14d4eefc547f4781bf7f9e')) OR contains(lower(process.file.hashes.value), lower('imphash=e6f9d5152da699934b30daab206471f6')) OR contains(lower(process.file.hashes.value), lower('imphash=3ad59991ccf1d67339b319b15a41b35d')) OR contains(lower(process.file.hashes.value), lower('imphash=ffdd59e0318b85a3e480874d9796d872')) OR contains(lower(process.file.hashes.value), lower('imphash=0cf479628d7cc1ea25ec7998a92f5051')) OR contains(lower(process.file.hashes.value), lower('imphash=07a2d4dcbd6cb2c6a45e6b101f0b6d51')) OR contains(lower(process.file.hashes.value), lower('imphash=d6d0f80386e1380d05cb78e871bc72b1')) OR contains(lower(process.file.hashes.value), lower('imphash=38d9e015591bbfd4929e0d0f47fa0055')) OR contains(lower(process.file.hashes.value), lower('imphash=0e2216679ca6e1094d63322e3412d650')) OR contains(lower(process.file.hashes.value), lower('imphash=ada161bf41b8e5e9132858cb54cab5fb')) OR contains(lower(process.file.hashes.value), lower('imphash=2a1bc4913cd5ecb0434df07cb675b798')) OR contains(lower(process.file.hashes.value), lower('imphash=11083e75553baae21dc89ce8f9a195e4')) OR contains(lower(process.file.hashes.value), lower('imphash=a23d29c9e566f2fa8ffbb79267f5df80')) OR contains(lower(process.file.hashes.value), lower('imphash=4a07f944a83e8a7c2525efa35dd30e2f')) OR contains(lower(process.file.hashes.value), lower('imphash=767637c23bb42cd5d7397cf58b0be688')) OR contains(lower(process.file.hashes.value), lower('imphash=14c4e4c72ba075e9069ee67f39188ad8')) OR contains(lower(process.file.hashes.value), lower('imphash=3c782813d4afce07bbfc5a9772acdbdc')) OR contains(lower(process.file.hashes.value), lower('imphash=7d010c6bb6a3726f327f7e239166d127')) OR contains(lower(process.file.hashes.value), lower('imphash=89159ba4dd04e4ce5559f132a9964eb3')) OR contains(lower(process.file.hashes.value), lower('imphash=6f33f4a5fc42b8cec7314947bd13f30f')) OR contains(lower(process.file.hashes.value), lower('imphash=5834ed4291bdeb928270428ebbaf7604')) OR contains(lower(process.file.hashes.value), lower('imphash=5a8a8a43f25485e7ee1b201edcbc7a38')) OR contains(lower(process.file.hashes.value), lower('imphash=dc7d30b90b2d8abf664fbed2b1b59894')) OR contains(lower(process.file.hashes.value), lower('imphash=41923ea1f824fe63ea5beb84db7a3e74')) OR contains(lower(process.file.hashes.value), lower('imphash=3de09703c8e79ed2ca3f01074719906b')) OR contains(lower(process.file.hashes.value), lower('imphash=a53a02b997935fd8eedcb5f7abab9b9f')) OR contains(lower(process.file.hashes.value), lower('imphash=e96a73c7bf33a464c510ede582318bf2')) OR contains(lower(process.file.hashes.value), lower('imphash=32089b8851bbf8bc2d014e9f37288c83')) OR contains(lower(process.file.hashes.value), lower('imphash=09d278f9de118ef09163c6140255c690')) OR contains(lower(process.file.hashes.value), lower('imphash=03866661686829d806989e2fc5a72606')) OR contains(lower(process.file.hashes.value), lower('imphash=e57401fbdadcd4571ff385ab82bd5d6d')) OR contains(lower(process.file.hashes.value), lower('imphash=84b763c45c0e4a3e7ca5548c710db4ee')) OR contains(lower(process.file.hashes.value), lower('imphash=19584675d94829987952432e018d5056')) OR contains(lower(process.file.hashes.value), lower('imphash=330768a4f172e10acb6287b87289d83b')) OR contains(lower(process.file.hashes.value), lower('imphash=885c99ccfbe77d1cbfcb9c4e7c1a3313')) OR contains(lower(process.file.hashes.value), lower('imphash=22a22bc9e4e0d2f189f1ea01748816ac')) OR contains(lower(process.file.hashes.value), lower('imphash=7fa30e6bb7e8e8a69155636e50bf1b28')) OR contains(lower(process.file.hashes.value), lower('imphash=96df3a3731912449521f6f8d183279b1')) OR contains(lower(process.file.hashes.value), lower('imphash=7e6cf3ff4576581271ac8a313b2aab46')) OR contains(lower(process.file.hashes.value), lower('imphash=51791678f351c03a0eb4e2a7b05c6e17')) OR contains(lower(process.file.hashes.value), lower('imphash=25ce42b079282632708fc846129e98a5')) OR contains(lower(process.file.hashes.value), lower('imphash=021bcca20ba3381b11bdde26b4e62f20')) OR contains(lower(process.file.hashes.value), lower('imphash=59223b5f52d8799d38e0754855cbdf42')) OR contains(lower(process.file.hashes.value), lower('imphash=81e75d8f1d276c156653d3d8813e4a43')) OR contains(lower(process.file.hashes.value), lower('imphash=17244e8b6b8227e57fe709ccad421420')) OR contains(lower(process.file.hashes.value), lower('imphash=5b76da3acdedc8a5cdf23a798b5936b4')) OR contains(lower(process.file.hashes.value), lower('imphash=cb2b65bb77d995cc1c0e5df1c860133c')) OR contains(lower(process.file.hashes.value), lower('imphash=40445337761d80cf465136fafb1f63e6')) OR contains(lower(process.file.hashes.value), lower('imphash=8a790f401b29fa87bc1e56f7272b3aa6')) OR contains(lower(process.file.hashes.value), lower('imphash=b50199e952c875241b9ce06c971ce3c1'))))"
      }
    },
    "output": {
      "summary": "Detects the execution of different Windows based hacktools via their import hash (imphash) even if the files have been renamed",
      "defaultContext": true
    },
    "metadata": {
      "version": 1.0,
      "severity": "Critical",
      "fidelity": "Investigative",
      "objective": "False positive: Legitimate use of one of these tools Reference: Internal Research",
      "mitre": [
        {
          "taxonomy": "MITRE ATT&CK",
          "tactic": "Credential-Access",
          "techniqueId": "T1588",
          "subTechniqueId": "002"
        },
        {
          "taxonomy": "MITRE ATT&CK",
          "tactic": "Credential-Access",
          "techniqueId": "T1003"
        }
      ]
    },
    "computeMode": "high"
  },
  "apiVersion": "v1",
  "kind": "Rule"
}