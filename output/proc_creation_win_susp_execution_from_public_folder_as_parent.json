{
  "metadata": {
    "name": "Potentially Suspicious Execution From Parent Process In Public Folder",
    "comment": "Detects a potentially suspicious execution of a parent process located in the \"\\Users\\Public\" folder executing a child process containing references to shell or scripting binaries and commandlines.",
    "annotations": {
      "source": "sigma",
      "category": "process_creation",
      "product": "windows",
      "sigma_status": "test"
    }
  },
  "spec": {
    "schedule": {
      "atLeastEvery": "12h",
      "enabled": false
    },
    "input": {
      "batch": {
        "sql": "SELECT * FROM process_activity WHERE time BETWEEN CURRENT_TIMESTAMP() - INTERVAL 24 HOUR AND CURRENT_TIMESTAMP() AND (activity_id = 1 AND contains(lower(process.parent_process.name), lower(':\\\\\\\\users\\\\\\\\public\\\\\\\\')) AND (endswith(lower(process.name), lower('\\\\\\\\bitsadmin.exe')) OR endswith(lower(process.name), lower('\\\\\\\\certutil.exe')) OR endswith(lower(process.name), lower('\\\\\\\\cmd.exe')) OR endswith(lower(process.name), lower('\\\\\\\\cscript.exe')) OR endswith(lower(process.name), lower('\\\\\\\\mshta.exe')) OR endswith(lower(process.name), lower('\\\\\\\\powershell.exe')) OR endswith(lower(process.name), lower('\\\\\\\\pwsh.exe')) OR endswith(lower(process.name), lower('\\\\\\\\regsvr32.exe')) OR endswith(lower(process.name), lower('\\\\\\\\rundll32.exe')) OR endswith(lower(process.name), lower('\\\\\\\\wscript.exe'))) AND (contains(lower(process.cmd_line), lower('bitsadmin')) OR contains(lower(process.cmd_line), lower('certutil')) OR contains(lower(process.cmd_line), lower('cscript')) OR contains(lower(process.cmd_line), lower('mshta')) OR contains(lower(process.cmd_line), lower('powershell')) OR contains(lower(process.cmd_line), lower('regsvr32')) OR contains(lower(process.cmd_line), lower('rundll32')) OR contains(lower(process.cmd_line), lower('wscript'))))"
      }
    },
    "output": {
      "summary": "Detects a potentially suspicious execution of a parent process located in the \"\\Users\\Public\" folder executing a child process containing references to shell or scripting binaries and commandlines.",
      "defaultContext": true
    },
    "metadata": {
      "version": 1.0,
      "severity": "High",
      "fidelity": "Investigative",
      "objective": "False positive: Unknown Reference: https://redcanary.com/blog/blackbyte-ransomware/",
      "mitre": [
        {
          "taxonomy": "MITRE ATT&CK",
          "tactic": "Defense-Evasion",
          "techniqueId": "T1564"
        },
        {
          "taxonomy": "MITRE ATT&CK",
          "tactic": "Defense-Evasion",
          "techniqueId": "T1059"
        }
      ]
    },
    "computeMode": "high"
  },
  "apiVersion": "v1",
  "kind": "Rule"
}