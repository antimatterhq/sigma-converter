{
  "metadata": {
    "name": "Suspicious Windows Service Tampering",
    "comment": "Detects the usage of binaries such as 'net', 'sc' or 'powershell' in order to stop, pause, disable or delete critical or important Windows services such as AV, Backup, etc. As seen being used in some ransomware scripts",
    "annotations": {
      "source": "sigma",
      "category": "process_creation",
      "product": "windows",
      "sigma_status": "test"
    }
  },
  "spec": {
    "schedule": {
      "atLeastEvery": "12h",
      "enabled": false
    },
    "input": {
      "batch": {
        "sql": "SELECT * FROM process_activity WHERE time BETWEEN CURRENT_TIMESTAMP() - INTERVAL 24 HOUR AND CURRENT_TIMESTAMP() AND (activity_id = 1 AND (lower(LOWER(process.file.name)) in ('net\\\\.exe', 'net1\\\\.exe', 'powershell\\\\.exe', 'psservice\\\\.exe', 'pwsh\\\\.dll', 'sc\\\\.exe')) AND (endswith(lower(process.name), lower('\\\\\\\\net.exe')) OR endswith(lower(process.name), lower('\\\\\\\\net1.exe')) OR endswith(lower(process.name), lower('\\\\\\\\powershell.exe')) OR endswith(lower(process.name), lower('\\\\\\\\psservice.exe')) OR endswith(lower(process.name), lower('\\\\\\\\psservice64.exe')) OR endswith(lower(process.name), lower('\\\\\\\\pwsh.exe')) OR endswith(lower(process.name), lower('\\\\\\\\sc.exe'))) AND (contains(lower(process.cmd_line), lower(' delete ')) OR contains(lower(process.cmd_line), lower(' pause ')) OR contains(lower(process.cmd_line), lower(' stop ')) OR contains(lower(process.cmd_line), lower('stop-service ')) OR contains(lower(process.cmd_line), lower('remove-service '))) AND contains(lower(process.cmd_line), lower('config')) AND contains(lower(process.cmd_line), lower('start=disabled')) AND (contains(lower(process.cmd_line), lower('143svc')) OR contains(lower(process.cmd_line), lower('acronis vss provider')) OR contains(lower(process.cmd_line), lower('acronisagent')) OR contains(lower(process.cmd_line), lower('acrsch2svc')) OR contains(lower(process.cmd_line), lower('adobearmservice')) OR contains(lower(process.cmd_line), lower('ahs service')) OR contains(lower(process.cmd_line), lower('antivirus')) OR contains(lower(process.cmd_line), lower('apache4')) OR contains(lower(process.cmd_line), lower('arsm')) OR contains(lower(process.cmd_line), lower('aswbcc')) OR contains(lower(process.cmd_line), lower('ateraagent')) OR contains(lower(process.cmd_line), lower('avast business console client antivirus service')) OR contains(lower(process.cmd_line), lower('avast! antivirus')) OR contains(lower(process.cmd_line), lower('avg antivirus')) OR contains(lower(process.cmd_line), lower('avgadminclient')) OR contains(lower(process.cmd_line), lower('avgadminserver')) OR contains(lower(process.cmd_line), lower('avp1')) OR contains(lower(process.cmd_line), lower('backupexec')) OR contains(lower(process.cmd_line), lower('bedbg')) OR contains(lower(process.cmd_line), lower('bits')) OR contains(lower(process.cmd_line), lower('brokerinfrastructure')) OR contains(lower(process.cmd_line), lower('caslicenceserver')) OR contains(lower(process.cmd_line), lower('caswebserver')) OR contains(lower(process.cmd_line), lower('client agent 7.60')) OR contains(lower(process.cmd_line), lower('core browsing protection')) OR contains(lower(process.cmd_line), lower('core mail protection')) OR contains(lower(process.cmd_line), lower('core scanning server')) OR contains(lower(process.cmd_line), lower('dcagent')) OR contains(lower(process.cmd_line), lower('dwmrcs')) OR contains(lower(process.cmd_line), lower('ehttpsr')) OR contains(lower(process.cmd_line), lower('ekrn')) OR contains(lower(process.cmd_line), lower('enterprise client service')) OR contains(lower(process.cmd_line), lower('epag')) OR contains(lower(process.cmd_line), lower('epintegrationservice')) OR contains(lower(process.cmd_line), lower('epprotectedservice')) OR contains(lower(process.cmd_line), lower('epredline')) OR contains(lower(process.cmd_line), lower('epsecurityservice')) OR contains(lower(process.cmd_line), lower('epupdateservice')) OR contains(lower(process.cmd_line), lower('erasersvc11710')) OR contains(lower(process.cmd_line), lower('esgshkernel')) OR contains(lower(process.cmd_line), lower('eshasrv')) OR contains(lower(process.cmd_line), lower('fa_scheduler')) OR contains(lower(process.cmd_line), lower('firebirdguardiandefaultinstance')) OR contains(lower(process.cmd_line), lower('firebirdserverdefaultinstance')) OR contains(lower(process.cmd_line), lower('fontcache3.0.0.0')) OR contains(lower(process.cmd_line), lower('healthtlservice')) OR contains(lower(process.cmd_line), lower('hmpalertsvc')) OR contains(lower(process.cmd_line), lower('hms')) OR contains(lower(process.cmd_line), lower('hostcontrollerservice')) OR contains(lower(process.cmd_line), lower('hvdsvc')) OR contains(lower(process.cmd_line), lower('iastordatamgrsvc')) OR contains(lower(process.cmd_line), lower('ibmhps')) OR contains(lower(process.cmd_line), lower('ibmspsvc')) OR contains(lower(process.cmd_line), lower('iisadmin')) OR contains(lower(process.cmd_line), lower('imansvc')) OR contains(lower(process.cmd_line), lower('imap4svc')) OR contains(lower(process.cmd_line), lower('instance2')) OR contains(lower(process.cmd_line), lower('kavfs')) OR contains(lower(process.cmd_line), lower('kavfsgt')) OR contains(lower(process.cmd_line), lower('kavfsslp')) OR contains(lower(process.cmd_line), lower('keyiso')) OR contains(lower(process.cmd_line), lower('klbackupdisk')) OR contains(lower(process.cmd_line), lower('klbackupflt')) OR contains(lower(process.cmd_line), lower('klflt')) OR contains(lower(process.cmd_line), lower('klhk')) OR contains(lower(process.cmd_line), lower('klif')) OR contains(lower(process.cmd_line), lower('klim6')) OR contains(lower(process.cmd_line), lower('klkbdflt')) OR contains(lower(process.cmd_line), lower('klmouflt')) OR contains(lower(process.cmd_line), lower('klnagent')) OR contains(lower(process.cmd_line), lower('klpd')) OR contains(lower(process.cmd_line), lower('kltap')) OR contains(lower(process.cmd_line), lower('ksde1.0.0')) OR contains(lower(process.cmd_line), lower('logprocessorservice')) OR contains(lower(process.cmd_line), lower('m8endpointagent')) OR contains(lower(process.cmd_line), lower('macmnsvc')) OR contains(lower(process.cmd_line), lower('masvc')) OR contains(lower(process.cmd_line), lower('mbamservice')) OR contains(lower(process.cmd_line), lower('mbcloudea')) OR contains(lower(process.cmd_line), lower('mbendpointagent')) OR contains(lower(process.cmd_line), lower('mcafeedlpagentservice')) OR contains(lower(process.cmd_line), lower('mcafeeengineservice')) OR contains(lower(process.cmd_line), lower('mcafeeeventparsersrv')) OR contains(lower(process.cmd_line), lower('mcafeeframework')) OR contains(lower(process.cmd_line), lower('mcafeetomcatsrv530')) OR contains(lower(process.cmd_line), lower('mcshield')) OR contains(lower(process.cmd_line), lower('mctaskmanager')) OR contains(lower(process.cmd_line), lower('mfefire')) OR contains(lower(process.cmd_line), lower('mfemms')) OR contains(lower(process.cmd_line), lower('mfevto')) OR contains(lower(process.cmd_line), lower('mfevtp')) OR contains(lower(process.cmd_line), lower('mfewc')) OR contains(lower(process.cmd_line), lower('mms')) OR contains(lower(process.cmd_line), lower('mozyprobackup')) OR contains(lower(process.cmd_line), lower('mpssvc')) OR contains(lower(process.cmd_line), lower('mscomplianceaudit')) OR contains(lower(process.cmd_line), lower('msdtc')) OR contains(lower(process.cmd_line), lower('msdtsserver')) OR contains(lower(process.cmd_line), lower('msexchange')) OR contains(lower(process.cmd_line), lower('msftesq1sproo')) OR contains(lower(process.cmd_line), lower('msftesql$prod')) OR contains(lower(process.cmd_line), lower('msftesql$sqlexpress')) OR contains(lower(process.cmd_line), lower('msolap$sql_2008')) OR contains(lower(process.cmd_line), lower('msolap$system_bgc')) OR contains(lower(process.cmd_line), lower('msolap$tps')) OR contains(lower(process.cmd_line), lower('msolap$tpsama')) OR contains(lower(process.cmd_line), lower('msolapstps')) OR contains(lower(process.cmd_line), lower('msolapstpsama')) OR contains(lower(process.cmd_line), lower('mssecflt')) OR contains(lower(process.cmd_line), lower('mssq!i.sprofxengagemeht')) OR contains(lower(process.cmd_line), lower('mssq0sharepoint')) OR contains(lower(process.cmd_line), lower('mssq0sophos')) OR contains(lower(process.cmd_line), lower('mssql')) OR contains(lower(process.cmd_line), lower('mssqlfdlauncher$')) OR contains(lower(process.cmd_line), lower('mysql')) OR contains(lower(process.cmd_line), lower('nanoservicemain')) OR contains(lower(process.cmd_line), lower('netmsmqactivator')) OR contains(lower(process.cmd_line), lower('netpipeactivator')) OR contains(lower(process.cmd_line), lower('netprofm')) OR contains(lower(process.cmd_line), lower('nettcpactivator')) OR contains(lower(process.cmd_line), lower('nettcpportsharing')) OR contains(lower(process.cmd_line), lower('ntrtscan')) OR contains(lower(process.cmd_line), lower('nvspwmi')) OR contains(lower(process.cmd_line), lower('ofcservice')) OR contains(lower(process.cmd_line), lower('online protection system')) OR contains(lower(process.cmd_line), lower('oracleclientcache80')) OR contains(lower(process.cmd_line), lower('oracledbconsole')) OR contains(lower(process.cmd_line), lower('oraclemtsrecoveryservice')) OR contains(lower(process.cmd_line), lower('oracleoradb11g_home1')) OR contains(lower(process.cmd_line), lower('oracleservice')) OR contains(lower(process.cmd_line), lower('oraclevsswriter')) OR contains(lower(process.cmd_line), lower('osppsvc')) OR contains(lower(process.cmd_line), lower('pandaaetheragent')) OR contains(lower(process.cmd_line), lower('pccntupd')) OR contains(lower(process.cmd_line), lower('pdvfsservice')) OR contains(lower(process.cmd_line), lower('pop3svc')) OR contains(lower(process.cmd_line), lower('postgresql-x64-9.4')) OR contains(lower(process.cmd_line), lower('povfsservice')) OR contains(lower(process.cmd_line), lower('psuaservice')) OR contains(lower(process.cmd_line), lower('quick update service')) OR contains(lower(process.cmd_line), lower('repairservice')) OR contains(lower(process.cmd_line), lower('reportserver')) OR contains(lower(process.cmd_line), lower('reportserver$')) OR contains(lower(process.cmd_line), lower('resvc')) OR contains(lower(process.cmd_line), lower('rpceptmapper')) OR contains(lower(process.cmd_line), lower('sacsvr')) OR contains(lower(process.cmd_line), lower('samss')) OR contains(lower(process.cmd_line), lower('savadminservice')) OR contains(lower(process.cmd_line), lower('savservice')) OR contains(lower(process.cmd_line), lower('scsecsvc')) OR contains(lower(process.cmd_line), lower('sdrsvc')) OR contains(lower(process.cmd_line), lower('searchexchangetracing')) OR contains(lower(process.cmd_line), lower('sense')) OR contains(lower(process.cmd_line), lower('sentinelagent')) OR contains(lower(process.cmd_line), lower('sentinelhelperservice')) OR contains(lower(process.cmd_line), lower('sepmasterservice')) OR contains(lower(process.cmd_line), lower('shmonitor')) OR contains(lower(process.cmd_line), lower('smcinst')) OR contains(lower(process.cmd_line), lower('smcservice')) OR contains(lower(process.cmd_line), lower('smtpsvc')) OR contains(lower(process.cmd_line), lower('snac')) OR contains(lower(process.cmd_line), lower('sntpservice')) OR contains(lower(process.cmd_line), lower('sophos')) OR contains(lower(process.cmd_line), lower('sq1safeolrservice')) OR contains(lower(process.cmd_line), lower('sql backups')) OR contains(lower(process.cmd_line), lower('sql server')) OR contains(lower(process.cmd_line), lower('sqlagent')) OR contains(lower(process.cmd_line), lower('sqlanys_sage_fas_fixed_assets')) OR contains(lower(process.cmd_line), lower('sqlbrowser')) OR contains(lower(process.cmd_line), lower('sqlsafe')) OR contains(lower(process.cmd_line), lower('sqlserveragent')) OR contains(lower(process.cmd_line), lower('sqltelemetry')) OR contains(lower(process.cmd_line), lower('sqlwriter')) OR contains(lower(process.cmd_line), lower('ssistelemetry130')) OR contains(lower(process.cmd_line), lower('sstpsvc')) OR contains(lower(process.cmd_line), lower('storflt')) OR contains(lower(process.cmd_line), lower('svcgenerichost')) OR contains(lower(process.cmd_line), lower('swc_service')) OR contains(lower(process.cmd_line), lower('swi_filter')) OR contains(lower(process.cmd_line), lower('swi_service')) OR contains(lower(process.cmd_line), lower('swi_update')) OR contains(lower(process.cmd_line), lower('symantec')) OR contains(lower(process.cmd_line), lower('sysmon')) OR contains(lower(process.cmd_line), lower('teamviewer')) OR contains(lower(process.cmd_line), lower('telemetryserver')) OR contains(lower(process.cmd_line), lower('threatlockerservice')) OR contains(lower(process.cmd_line), lower('tmbmserver')) OR contains(lower(process.cmd_line), lower('tmccsf')) OR contains(lower(process.cmd_line), lower('tmfilter')) OR contains(lower(process.cmd_line), lower('tmicrcscanservice')) OR contains(lower(process.cmd_line), lower('tmlisten')) OR contains(lower(process.cmd_line), lower('tmlwcsservice')) OR contains(lower(process.cmd_line), lower('tmpfw')) OR contains(lower(process.cmd_line), lower('tmprefilter')) OR contains(lower(process.cmd_line), lower('tmproxy')) OR contains(lower(process.cmd_line), lower('tmsmartrelayservice')) OR contains(lower(process.cmd_line), lower('tmusa')) OR contains(lower(process.cmd_line), lower('tomcat')) OR contains(lower(process.cmd_line), lower('trend micro deep security manager')) OR contains(lower(process.cmd_line), lower('truekey')) OR contains(lower(process.cmd_line), lower('ufnet')) OR contains(lower(process.cmd_line), lower('ui0detect')) OR contains(lower(process.cmd_line), lower('unifi')) OR contains(lower(process.cmd_line), lower('utodetect')) OR contains(lower(process.cmd_line), lower('vds')) OR contains(lower(process.cmd_line), lower('veeam')) OR contains(lower(process.cmd_line), lower('veeamdeploysvc')) OR contains(lower(process.cmd_line), lower('veritas system recovery')) OR contains(lower(process.cmd_line), lower('vmic')) OR contains(lower(process.cmd_line), lower('vmtools')) OR contains(lower(process.cmd_line), lower('vmvss')) OR contains(lower(process.cmd_line), lower('vsapint')) OR contains(lower(process.cmd_line), lower('vss')) OR contains(lower(process.cmd_line), lower('w3svc')) OR contains(lower(process.cmd_line), lower('wbengine')) OR contains(lower(process.cmd_line), lower('wdnissvc')) OR contains(lower(process.cmd_line), lower('weancloudsve')) OR contains(lower(process.cmd_line), lower('weems jy')) OR contains(lower(process.cmd_line), lower('windefend')) OR contains(lower(process.cmd_line), lower('wmms')) OR contains(lower(process.cmd_line), lower('wozyprobackup')) OR contains(lower(process.cmd_line), lower('wpffontcache_v0400')) OR contains(lower(process.cmd_line), lower('wrsvc')) OR contains(lower(process.cmd_line), lower('wsbexchange')) OR contains(lower(process.cmd_line), lower('wsearch')) OR contains(lower(process.cmd_line), lower('wscsvc')) OR contains(lower(process.cmd_line), lower('zoolz 2 service'))))"
      }
    },
    "output": {
      "summary": "Detects the usage of binaries such as 'net', 'sc' or 'powershell' in order to stop, pause, disable or delete critical or important Windows services such as AV, Backup, etc. As seen being used in some ransomware scripts",
      "defaultContext": true
    },
    "metadata": {
      "version": 1.0,
      "severity": "High",
      "fidelity": "Investigative",
      "objective": "False positive: Administrators or tools shutting down the services due to upgrade or removal purposes. If you experience some false positive, please consider adding filters to the parent process launching this command and not removing the entry References: https://www.trendmicro.com/content/dam/trendmicro/global/en/research/22/h/ransomware-actor-abuses-genshin-impact-anti-cheat-driver-to-kill-antivirus/Genshin%20Impact%20Figure%2010.jpg, https://www.trellix.com/en-sg/about/newsroom/stories/threat-labs/lockergoga-ransomware-family-used-in-targeted-attacks.html, https://github.com/redcanaryco/atomic-red-team/blob/f339e7da7d05f6057fdfcdd3742bfcf365fee2a9/atomics/T1562.001/T1562.001.md, https://research.nccgroup.com/2022/08/19/back-in-black-unlocking-a-lockbit-3-0-ransomware-attack/, https://www.virustotal.com/gui/file/38283b775552da8981452941ea74191aa0d203edd3f61fb2dee7b0aea3514955",
      "mitre": [
        {
          "taxonomy": "MITRE ATT&CK",
          "tactic": "Defense-Evasion",
          "techniqueId": "T1489"
        },
        {
          "taxonomy": "MITRE ATT&CK",
          "tactic": "Defense-Evasion",
          "techniqueId": "T1562",
          "subTechniqueId": "001"
        }
      ]
    },
    "computeMode": "high"
  },
  "apiVersion": "v1",
  "kind": "Rule"
}