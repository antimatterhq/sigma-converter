id: f68c4a4f-19ef-4817-952c-50dce331f4b0
title: Potential WizardUpdate Malware Infection
status: test
level: high
description: Detects the execution traces of the WizardUpdate malware. WizardUpdate
    is a macOS trojan that attempts to infiltrate macOS machines to steal data and
    it is associated with other types of malicious payloads, increasing the chances
    of multiple infections on a device.
author: Tim Rauch (rule), Elastic (idea)
date: '2022-10-17'
tags:
    - attack.command-and-control
references:
    - https://github.com/elastic/protections-artifacts/commit/746086721fd385d9f5c6647cada1788db4aea95f#diff-c68a1fcbf7a3f80c87225d7fdc031f691e9f3b6a14a36754be00762bfe6eae97
    - https://malpedia.caad.fkie.fraunhofer.de/details/osx.xcsset
    - https://www.microsoft.com/security/blog/2022/02/02/the-evolution-of-a-mac-trojan-updateagents-progression/
falsepositives:
    - Unknown
taxonomy: sigma
logsource:
    category: process_creation
    product: macos
detection:
    selection_1:
        Image|endswith: /sh
        CommandLine|contains|all:
            - '=$(curl '
            - eval
    selection_2:
        Image|endswith: /curl
        CommandLine|contains: _intermediate_agent_
    condition: 1 of selection_*
ocsf_mapping:
    class_name: process_activity
    activity_id: 1
    logsource:
        category:
            source_field: category
            source_value: process_creation
            mapped_at: '2025-11-26T02:13:40.128500+00:00'
        product:
            source_field: product
            source_value: macos
            mapped_at: '2025-11-26T02:13:40.128500+00:00'
    detection_fields:
        -   source_field: Image
            target_table: process_activity
            target_field: process.name
            mapped_at: '2025-11-26T02:13:40.128512+00:00'
        -   source_field: CommandLine
            target_table: process_activity
            target_field: process.cmd_line
            mapped_at: '2025-11-26T02:13:40.128514+00:00'
