id: 555155a2-03bf-4fe7-af74-d176b3fdbe16
title: Driver Added To Disallowed Images In HVCI - Registry
status: experimental
level: high
description: 'Detects changes to the "HVCIDisallowedImages" registry value to potentially
    add a driver to the list, in order to prevent it from loading.

    '
author: Nasreddine Bencherchali (Nextron Systems), Omar Khaled (@beacon_exe)
date: '2023-12-05'
modified: '2024-08-21'
tags:
    - attack.defense-evasion
references:
    - https://github.com/yardenshafir/conference_talks/blob/3de1f5d7c02656c35117f067fbff0a219c304b09/OffensiveCon_2023_Your_Mitigations_are_My_Opportunities.pdf
    - https://x.com/yarden_shafir/status/1822667605175324787
falsepositives:
    - Legitimate usage of this key would also trigger this. Investigate the driver
        being added and make sure its intended
related: 'SigmaRelated(related=[SigmaRelatedItem(id=UUID(''44cee399-f6b1-45cc-a87c-ea14c6064d6b''),
    type=<SigmaRelatedType.SIMILAR: 6>)])'
taxonomy: sigma
logsource:
    category: registry_set
    product: windows
detection:
    selection:
        TargetObject|contains|all:
            - \Control\CI\
            - \HVCIDisallowedImages
    condition: selection
ocsf_mapping:
    class_name: null
    logsource:
        category:
            source_field: category
            source_value: registry_set
            mapped_at: null
        product:
            source_field: product
            source_value: windows
            mapped_at: null
    detection_fields:
        -   source_field: TargetObject
            target_table: null
            target_field: null
            mapped_at: null
